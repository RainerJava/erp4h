<?xml version="1.0" encoding="utf-8" ?>
<System>
	<M_REPORT006>
		SELECT
			COALESCE(MT.CUST_CODE,'') AS CUST_CODE
		    ,COALESCE(MT.CUST1_NAME,'') AS CUST1_NAME
		    ,COALESCE(ME.NAME_NAME,'') AS NAME_NAME
		    ,COALESCE(M.SHIP_NO,'') AS SHIP_NO
		    ,COALESCE(MW.NAME_NAME,'') AS DRAW_TYPE
		    ,COALESCE(M.BLOCK_NAME,'') AS BLOCK_NAME
		    ,COALESCE(TM.PAGE_NO,0) AS PAGE_NO
		    ,COALESCE(TM.PIPE_SIGN,'') AS PIPE_SIGN
		    ,COALESCE(TD.CS_QTY,0) AS CS_QTY
		    ,COALESCE(MT.OODR_TYPE,'') AS OODR_TYPE
		    ,COALESCE(TD.TANDB_TYPE ,'') AS TANDB_CODE
            ,COALESCE(METD.NAME_NAME,'') AS TANDB_NAME
            ,COALESCE(M.DLVR_DATE,0) AS DLVR_DATE
            ,COALESCE(M.SIGN_NO,'') AS SIGN_NO
		FROM
		    TR_PIPEH AS M
		    LEFT JOIN TR_PIPED AS TD ON M.MN_NO =  TD.MN_NO AND M.MN_DATE =  TD.MN_DATE
		    JOIN TR_PIPEMT AS TM ON TD.MN_NO =  TM.MN_NO AND TD.MN_DATE =  TM.MN_DATE AND TD.PAGE_NO = TM.PAGE_NO AND TD.TANDB_TYPE = TM.TANDB_TYPE
		    LEFT JOIN M_CUST AS MT ON M.CUST_CODE = MT.CUST_CODE
			LEFT JOIN (select * from M_NAME where NAMECLS_CODE = 'TTL' AND DSP_FLG ='0') AS ME ON MT.TTL_CODE =  ME.NAME_CODE
		    LEFT JOIN (select * from M_NAME where NAMECLS_CODE = 'DRAW' AND DSP_FLG ='0') AS MW ON M.DRAW_TYPE =  MW.NAME_CODE
		    LEFT JOIN (select * from M_NAME where NAMECLS_CODE = 'TANDB' AND DSP_FLG ='0') AS METD ON TD.TANDB_TYPE =  METD.NAME_CODE

	</M_REPORT006>

	<M_REPORT011>
		 SELECT
		    COALESCE(MALL.CUST_CODE,'') AS CUST_CODE
		    ,COALESCE(MALL.CUST1_NAME,'') AS CUST1_NAME
		    ,COALESCE(MALL.TTL_NAME,'') AS TTL_NAME
		    ,COALESCE(MALL.SHIP_NO,'') AS SHIP_NO
		    ,COALESCE(MALL.DRAW_NAME,'') AS DRAW_NAME
		    ,COALESCE(MALL.MCLS_NAME,'') AS MCLS_NAME
		    ,COALESCE(MALL.LCLS_NAME,'') AS LCLS_NAME
		    ,COALESCE(MALL.TYPE_NAME,'') AS TYPE_NAME
		    ,COALESCE(MALL.MATER_NAME,'') AS MATER_NAME
		    ,COALESCE(MALL.PDMETER,'') AS PDMETER
		    ,COALESCE(MALL.STD_NAME,'') AS STD_NAME
		    ,COALESCE(MALL.SIZE_NAME,'') AS SIZE_NAME
		    ,COALESCE(MALL.DEC_QTY,0) AS DEC_QTY
		    ,COALESCE(MALL.CUST_MNY,0) AS CUST_MNY
		    ,COALESCE(MALL.ORDR_QTY,0) AS ORDR_QTY
		    ,COALESCE(MALL.SUPP_MNY,0) AS SUPP_MNY
		FROM
		(
		    	SELECT DISTINCT
		    	    COALESCE(MT.CUST_CODE,'') AS CUST_CODE
		    	    ,COALESCE(MT.CUST1_NAME,'') AS CUST1_NAME
		    	    ,COALESCE(ME.NAME_NAME,'') AS TTL_NAME
		    	    ,COALESCE(M.SHIP_NO,'') AS SHIP_NO
		    	    ,COALESCE(MW.NAME_NAME,'') AS DRAW_NAME
		    	    ,COALESCE(MCLS.MCLS_NAME,'') AS MCLS_NAME
		    	    ,COALESCE(LCLS.LCLS_NAME,'') AS LCLS_NAME
		    	    ,COALESCE(MTE.TYPE_NAME,'') AS TYPE_NAME
		    	    ,COALESCE(MTR.MATER_NAME,'') AS MATER_NAME
		    	    ,COALESCE(M.PDMETER,'') AS PDMETER
		    	    ,COALESCE(MSD.STD_NAME,'')+ ' '+ COALESCE(MK.KIND_NAME,'') AS STD_NAME
		    	    ,COALESCE(M.SIZE_NAME,'') AS SIZE_NAME
		    	    ,COALESCE(M.DEC_QTY,0) AS DEC_QTY
		    	    ,COALESCE(M.CUST_MNY,0) AS CUST_MNY
		    	    ,COALESCE(M.ORDR_QTY,0) AS ORDR_QTY
		    	    ,COALESCE(M.SUPP_MNY,0) AS SUPP_MNY
		            ,COALESCE(M.LCLS_CODE,'') AS LCLS_CODE
		            ,COALESCE(M.MCLS_CODE,'') AS MCLS_CODE
		            ,COALESCE(MTE.DSPORDER_NO,0) AS MTE_DSPORDER_NO
		            ,COALESCE(MTR.DSPORDER_NO,0) AS MTR_DSPORDER_NO
		            ,COALESCE(MSD.DSPORDER_NO,0) AS MSD_DSPORDER_NO
		            ,COALESCE(PD.DSPORDER_NO,0) AS PD_DSPORDER_NO
		            ,COALESCE(MK.KIND_NAME,'') AS KIND_NAME
		            ,COALESCE(M.DRAW_TYPE ,'') AS DRAW_TYPE
		            ,COALESCE(M.ADD_PC,'') AS ADD_PC
		    	FROM
		    	    F_PIPECL AS M
		    	    LEFT JOIN M_CUST AS MT ON M.CUST_CODE = MT.CUST_CODE
		    	    LEFT JOIN  M_NAME ME ON (ME.NAMECLS_CODE = 'TTL' AND ME.DSP_FLG ='0' AND MT.TTL_CODE =  ME.NAME_CODE)
		            LEFT JOIN  M_NAME MW ON (MW.NAMECLS_CODE = 'DRAW' AND MW.DSP_FLG ='0' AND  M.DRAW_TYPE =  MW.NAME_CODE)
		            LEFT JOIN  M_NAME PD ON (PD.NAMECLS_CODE = 'PDMETER' AND PD.DSP_FLG ='0' AND M.PDMETER =  PD.NAME_CODE)
		    	    LEFT JOIN M_LCLS AS LCLS ON LCLS.LCLS_CODE = M.LCLS_CODE
		    	    LEFT JOIN M_MCLS AS MCLS ON M.LCLS_CODE = MCLS.LCLS_CODE AND M.MCLS_CODE = MCLS.MCLS_CODE
		    	    LEFT JOIN M_TYPE AS MTE ON MTE.TYPE_CODE =  M.TYPE_CODE
		    	    LEFT JOIN M_MATER AS MTR ON MTR.MATER_CODE =  M.MATER_CODE
		    	    LEFT JOIN M_STD AS MSD ON MSD.STD_CODE =  M.STD_CODE
		    	    LEFT JOIN M_KIND AS MK ON MK.KIND_CODE =  M.KIND_CODE
		) AS MALL
	</M_REPORT011>

	<M_REPORT013>
		SELECT
            COALESCE(ME.NAME_NAME , CAST(M.DLVR_DATE as char)) AS NAME_NAME
            ,COALESCE(M.SIGN_NO,'') AS SIGN_NO
            ,COALESCE(M.COMP_TYPE,'') AS COMP_TYPE
		FROM
   			TR_PIPEH AS M
			LEFT JOIN (select * from M_NAME where NAMECLS_CODE = 'HURRY' AND DSP_FLG = '0') AS ME ON M.HURRY_TYPE =  ME.NAME_CODE

	</M_REPORT013>
	<M_REPORT010>
		SELECT
			 COALESCE(MALL.CUST_CODE,'') AS CUST_CODE
			,COALESCE(MALL.CUST_NAME,'') AS CUST_NAME
			,COALESCE(MALL.TTL_NAME,'') AS TTL_NAME
			,COALESCE(MALL.SHIP_NO,'') AS SHIP_NO
			,COALESCE(MALL.DRAW_NAME,'') AS DRAW_NAME
			,COALESCE(MALL.MCLS_NAME,'') AS MCLS_NAME
			,COALESCE(MALL.LCLS_NAME,'') AS LCLS_NAME
			,COALESCE(MALL.TYPE_NAME,'') AS TYPE_NAME
			,COALESCE(MALL.MATER_NAME,'') AS MATER_NAME
			,COALESCE(MALL.PDMETER,'') AS PDMETER
			,COALESCE(MALL.STD_NAME,'') AS STD_NAME
			,COALESCE(MALL.SIZE_NAME,'') AS SIZE_NAME
			,COALESCE(MALL.DEC_QTY,0) AS DEC_QTY
			,COALESCE(MALL.CUST_MNY,0) AS CUST_MNY
			,COALESCE(MALL.CL_DATE,0) AS CL_DATE
		FROM
		(SELECT 
					COALESCE(MT.CUST_CODE,'') AS CUST_CODE
					,COALESCE(MT.CUST1_NAME,'') AS CUST_NAME
					,COALESCE(ME.NAME_NAME,'') AS TTL_NAME
					,COALESCE(M.SHIP_NO,'') AS SHIP_NO
					,COALESCE(MW.NAME_NAME,'') AS DRAW_NAME
					,COALESCE(MCLS.MCLS_NAME,'') AS MCLS_NAME
					,COALESCE(LCLS.LCLS_NAME,'') AS LCLS_NAME
					,COALESCE(MTE.TYPE_NAME,'') AS TYPE_NAME
					,COALESCE(MTR.MATER_NAME,'') AS MATER_NAME
					,COALESCE(PD.NAME_NAME,'') AS PDMETER
					,COALESCE(MSD.STD_NAME,'')+ ' '+ COALESCE(MK.KIND_NAME,'') AS STD_NAME
					,COALESCE(M.SIZE_NAME,'') AS SIZE_NAME
					,SUM(M.DEC_QTY) AS DEC_QTY
					,SUM(ROUND(M.DEC_QTY*M.CUST_MNY,0)) AS CUST_MNY
					,COALESCE(M.CL_DATE,0) AS CL_DATE
					,COALESCE(M.LCLS_CODE,'') AS LCLS_CODE
					,COALESCE(M.MCLS_CODE,'') AS MCLS_CODE
					,COALESCE(MTE.DSPORDER_NO,0) AS MTE_DSPORDER_NO
					,COALESCE(MTR.DSPORDER_NO,0) AS MTR_DSPORDER_NO
					,COALESCE(MSD.DSPORDER_NO,0) AS MSD_DSPORDER_NO
					,COALESCE(PD.DSPORDER_NO,0) AS PD_DSPORDER_NO
					,COALESCE(MK.KIND_NAME,'') AS KIND_NAME
					,COALESCE(M.DRAW_TYPE ,'') AS DRAW_TYPE
					,COALESCE(M.ADD_PC,'') AS ADD_PC
				FROM
					F_PIPECL AS M
					LEFT JOIN M_CUST AS MT ON M.CUST_CODE = MT.CUST_CODE
					LEFT JOIN  M_NAME ME ON (ME.NAMECLS_CODE = 'TTL' AND ME.DSP_FLG ='0' AND MT.TTL_CODE =  ME.NAME_CODE)
					LEFT JOIN  M_NAME MW ON (MW.NAMECLS_CODE = 'DRAW' AND MW.DSP_FLG ='0' AND  M.DRAW_TYPE =  MW.NAME_CODE)
					LEFT JOIN  M_NAME PD ON (PD.NAMECLS_CODE = 'PDMETER' AND PD.DSP_FLG ='0' AND M.PDMETER =  PD.NAME_CODE)
					LEFT JOIN M_LCLS AS LCLS ON LCLS.LCLS_CODE = M.LCLS_CODE
					LEFT JOIN M_MCLS AS MCLS ON M.LCLS_CODE = MCLS.LCLS_CODE AND M.MCLS_CODE = MCLS.MCLS_CODE
					LEFT JOIN M_TYPE AS MTE ON MTE.TYPE_CODE =  M.TYPE_CODE
					LEFT JOIN M_MATER AS MTR ON MTR.MATER_CODE =  M.MATER_CODE
					LEFT JOIN M_STD AS MSD ON MSD.STD_CODE =  M.STD_CODE
					LEFT JOIN M_KIND AS MK ON MK.KIND_CODE =  M.KIND_CODE
				GROUP BY 
					 MT.CUST_CODE
					,MT.CUST1_NAME
					,ME.NAME_NAME
					,M.SHIP_NO
					,MW.NAME_NAME
					,MCLS.MCLS_NAME
					,LCLS.LCLS_NAME
					,MTE.TYPE_NAME
					,MTR.MATER_NAME
					,PD.NAME_NAME
					,MSD.STD_NAME
					,M.SIZE_NAME
					,M.CL_DATE
					,M.LCLS_CODE
					,M.MCLS_CODE
					,MTE.DSPORDER_NO
					,MTR.DSPORDER_NO
					,MSD.DSPORDER_NO
					,PD.DSPORDER_NO
					,MK.KIND_NAME
					,M.DRAW_TYPE 
					,M.ADD_PC
		) AS MALL
	</M_REPORT010>

	<M_REPORT016>
			 SELECT
	               COALESCE(M.CUST_CODE,'') AS CUST_CODE
	              ,COALESCE(MT.CUSTR_NAME,'') AS CUST1_NAME
	              ,COALESCE(M.SHIP_NO,'') AS SHIP_NO
	              ,COALESCE(ME.NAME_NAME,'') AS PROC_NAME
	              ,COALESCE(M.SIGN_NO,'') AS SIGN_NO
	              ,COALESCE(M.BLOCK_NAME,'') AS BLOCK_NAME
	              ,COALESCE(M.DRAW_NO,'') AS DRAW_NO
	              ,COALESCE(LS.MCLS_NAME,'') AS MEMBER_NAME
	              ,COALESCE(TS.PDMETER,'') AS PDMETER
	              ,COALESCE(MTE.TYPE_NAME,'') AS TYPE_NAME
	              ,COALESCE(MSD.STD_NAME,'') AS STD_NAME
	              ,COALESCE(MTR.MATER_TNAME,'') AS MATER_NAME
	              ,COALESCE(TS.SIZE_NAME,'') AS SIZE_NAME
	              ,CASE
					WHEN MT.OODR_TYPE = '1' THEN  SUM(TS.AMT_QTY)
					ELSE SUM(TS.AMT_QTY * TD.CS_QTY)
					END 'AMT_QTY'
	              ,COALESCE(TS.LCLS_CODE,'') AS LCLS_CODE
	              ,COALESCE(TS.MCLS_CODE,'') AS MCLS_CODE
	              ,COALESCE(TS.SIZE_NAME,'') AS ORDER_SIZE_NAME
	              ,COALESCE(MTE.DSPORDER_NO,1) AS TYPE_DSPORDER_NO
	              ,COALESCE(MTR.DSPORDER_NO,1) AS MATER_DSPORDER_NO
	              ,COALESCE(MSD.DSPORDER_NO,1) AS STD_DSPORDER_NO
	              ,COALESCE(MNAME.DSPORDER_NO,1) AS MNAME_DSPORDER_NO
	              ,TS.LCLS_CODE
	              ,TS.MCLS_CODE
	          FROM
	              (select * from TR_PIPEH $WHERE) AS M
	              LEFT JOIN TR_PIPED AS TD ON M.MN_NO =  TD.MN_NO AND M.MN_DATE =  TD.MN_DATE
	              LEFT JOIN (select * from TR_PIPES where LCLS_CODE != '0' and TEMP_TYPE = '1') AS TS ON TD.MN_NO =  TS.MN_NO AND TD.MN_DATE =  TS.MN_DATE AND TD.PAGE_NO =  TS.PAGE_NO AND TD.TANDB_TYPE =  TS.TANDB_TYPE
	              LEFT JOIN M_MCLS as LS on TS.MCLS_CODE = LS.MCLS_CODE AND TS.LCLS_CODE = LS.LCLS_CODE
	              JOIN (select * from M_NAME where NAMECLS_CODE = 'PROC' AND DSP_FLG ='0') AS ME ON RTRIM(TS.PROC_TYPE) =  RTRIM(ME.NAME_CODE)
	              LEFT JOIN M_TYPE AS MTE ON MTE.TYPE_CODE =  TS.TYPE_CODE
	              LEFT JOIN M_STD AS MSD ON MSD.STD_CODE =  TS.STD_CODE
	              LEFT JOIN M_MATER AS MTR ON MTR.MATER_CODE =  TS.MATER_CODE
	              LEFT JOIN M_CUST AS MT ON M.CUST_CODE = MT.CUST_CODE
	              LEFT JOIN (select * from M_NAME where NAMECLS_CODE = 'PDMETER' AND DSP_FLG ='0') AS MNAME ON RTRIM(TS.PDMETER) =  RTRIM(MNAME.NAME_CODE)
			GROUP BY
		        M.CUST_CODE
		        ,MT.CUSTR_NAME
		        ,M.SHIP_NO
		        ,TS.PROC_TYPE
		        ,ME.NAME_NAME
		        ,M.SIGN_NO
		        ,M.BLOCK_NAME
		        ,M.DRAW_NO
		        ,TS.LCLS_CODE
		        ,TS.MCLS_CODE
		        ,LS.MCLS_NAME
		        ,MTE.TYPE_NAME
		        ,MTE.DSPORDER_NO
		        ,MTR.MATER_TNAME
		        ,MTR.DSPORDER_NO
		        ,TS.PDMETER
		        ,MNAME.DSPORDER_NO
		        ,MSD.STD_NAME
		        ,MSD.DSPORDER_NO
		        ,TS.SIZE_NAME
		        ,MT.OODR_TYPE
	</M_REPORT016>
	
	<!--Add by HUNG NV 2010.10.06-->
	<M_REPORT016_1>
		SELECT
				S.MN_NO,
				S.MN_DATE,
				S.PAGE_NO,
				S.[TANDB_TYPE],
				TANDB.NAME_NAME AS [TANDB_NAME],
				S.[GYO_NO],
				S.[PROC_TYPE],
				PROCT.NAME_NAME AS [PROC_NAME],
				S.[LCLS_CODE],
				LCLS.LCLS_NAME,
				S.[MCLS_CODE],
				MCLS.MCLS_NAME,
				S.[SCLS_CODE],
				SCLS.SCLS_NAME,
				S.[TYPE_CODE],
				MTYPE.TYPE_NAME,
				S.[PDMETER],
				PDMET.NAME_NAME AS [PDMETER_NAME],
				S.[MATER_CODE],
				MATER.MATER_TNAME,
				S.[STD_CODE],
				MSTD.STD_NAME,
			    S.[SIZE_NAME],
				S.LEN_QTY,
				CASE
        			WHEN S.LEN_QTY > S.LENMK_QTY THEN S.LEN_QTY
        			ELSE S.LENMK_QTY
    			END AS LENMK_QTY,
				S.AMT_QTY,
				S.TEMP_TYPE,
				S.PRVS_TYPE,
				S.ADD_USER,
				S.ADD_PC,
				S.ADD_DATE,
				S.ADD_TIME,
				S.LASTUP_USER,
				S.LASTUP_PC,
				S.LASTUP_DATE,
				S.LASTUP_TIME,
				0 as STT,
				0 as KQDH,
				0 as SUPP_TYPE,
				D.CS_QTY,
				M.CUST_CODE,
				(SELECT CUSTR_NAME FROM M_CUST WHERE M.CUST_CODE = CUST_CODE) AS CUSTR_NAME,
				M.BLOCK_NAME,
				M.DRAW_NO,
				MCLS.SUS_TYPE AS MCLS_SUSTYPE,
				MCUST.OODR_TYPE AS CUST_OODRTYPE,				
				MPROC.NAME_NAME AS PROC_NAME,
				M.SIGN_NO,
				M.BLOCK_NAME,
				M.DRAW_NO
		FROM
			TR_PIPES S INNER JOIN TR_PIPED D ON (S.MN_DATE = D.MN_DATE AND S.MN_NO = D.MN_NO AND S.PAGE_NO = D.PAGE_NO AND S.TANDB_TYPE = D.TANDB_TYPE)
					   INNER JOIN TR_PIPEH M ON (S.MN_DATE = M.MN_DATE AND S.MN_NO = M.MN_NO)
					   LEFT JOIN  M_NAME TANDB ON (TANDB.NAMECLS_CODE = 'TANDB'   AND TANDB.NAME_CODE = S.TANDB_TYPE)
					   LEFT JOIN  M_NAME PROCT ON (PROCT.NAMECLS_CODE = 'PROC'    AND PROCT.NAME_CODE = S.PROC_TYPE)
					   LEFT JOIN  M_NAME PDMET ON (PDMET.NAMECLS_CODE = 'PDMETER' AND PDMET.NAME_CODE = S.PDMETER)
					   LEFT JOIN  M_TYPE MTYPE ON (MTYPE.TYPE_CODE = S.TYPE_CODE)
					   LEFT JOIN  M_MATER MATER ON (MATER.MATER_CODE = S.MATER_CODE)
					   LEFT JOIN  M_STD MSTD ON (MSTD.STD_CODE = S.STD_CODE)
					   LEFT JOIN  M_LCLS LCLS ON (LCLS.LCLS_CODE = S.LCLS_CODE)
					   LEFT JOIN  M_MCLS MCLS ON (MCLS.LCLS_CODE = S.LCLS_CODE AND MCLS.MCLS_CODE = S.MCLS_CODE)
					   LEFT JOIN  M_SCLS SCLS ON (SCLS.LCLS_CODE = S.LCLS_CODE AND SCLS.MCLS_CODE = S.MCLS_CODE AND SCLS.SCLS_CODE = S.SCLS_CODE)
					   LEFT JOIN  M_CUST MCUST ON (MCUST.CUST_CODE = M.CUST_CODE)
					   LEFT JOIN M_SPPROD AS MSPPROD ON S.LCLS_CODE = MSPPROD.LCLS_CODE AND S.MCLS_CODE = MSPPROD.MCLS_CODE
					   LEFT JOIN M_SUPP AS MSUPP ON MSUPP.SUPP_CODE = MSPPROD.SUPP1_CODE
					   INNER JOIN (select * from M_NAME where NAMECLS_CODE = 'PROC' AND DSP_FLG ='0') AS MPROC ON RTRIM(S.PROC_TYPE) =  RTRIM(MPROC.NAME_CODE)
		strCondition
		ORDER BY S.PRVS_TYPE, S.MCLS_CODE, S.MATER_CODE DESC, S.TYPE_CODE, S.PDMETER, S.STD_CODE, S.SIZE_NAME, S.LEN_QTY
	</M_REPORT016_1>

	<!-- add by PHUONGNT 2010.08.011 15h56 -->
	<M_REPORT0012>
	SELECT
		COALESCE(MT.CUST_CODE,'') AS CUST_CODE
		,COALESCE(MT.CUST1_NAME,'') AS CUST1_NAME
		,COALESCE(MT.CUSTR_NAME,'') AS CUSTR_NAME
		 selectShipNo
		,COALESCE(MW.NAME_NAME,'') AS DRAW_TYPE
		,COALESCE(MCLS.MCLS_NAME,'') AS MCLS_NAME
		,COALESCE(LCLS.LCLS_NAME,'') AS LCLS_NAME
        ,COALESCE(M.PDMETER,'') AS PDMETER
        ,COALESCE(MTE.TYPE_NAME,'') AS TYPE_NAME
        ,COALESCE(MSD.STD_NAME,'') AS STD_NAME
        ,COALESCE(MTR.MATER_TNAME,'') AS MATER_NAME
        ,COALESCE(M.SIZE_NAME,'') AS SIZE_NAME
        ,COALESCE(M.AMT_QTY,0) AS AMT_QTY
		,COALESCE(MP.SUPPR_NAME,'') AS SUPPR_NAME
		,COALESCE(M.PRVS_TYPE,'') AS PRVS_TYPE
        ,(SELECT
			SUM(ORDR_QTY)
		FROM
			TR_ORDRD OD
			INNER JOIN TR_ORDRH OH ON (OD.ORDR_NO = OH.ORDR_NO AND OD.MN_DATE = OH.MN_DATE AND OD.CUST_CODE = OH.CUST_CODE AND OD.DRAW_TYPE = OH.DRAW_TYPE )
		WHERE
			OD.CUST_CODE = M.CUST_CODE
			AND
			joinSHipNo
			AND
			OD.DRAW_TYPE = M.DRAW_TYPE
			AND
			OD.LCLS_CODE = M.LCLS_CODE
			AND
			OD.MCLS_CODE = M.MCLS_CODE
			AND
			OD.TYPE_CODE = M.TYPE_CODE
			AND
			OD.PDMETER = M.PDMETER
			AND
			OD.MATER_CODE = M.MATER_CODE
			AND
			OD.STD_CODE = M.STD_CODE
			AND
			OD.SIZE_NAME = M.SIZE_NAME
		    strConditionSumOrdr
		) AS ORDR_QTY
		,M.LCLS_CODE
		,M.MCLS_CODE
		,M.TYPE_CODE
		,M.MATER_CODE
		,M.PDMETER
		,M.STD_CODE
		,MTE.DSPORDER_NO AS TYPE_DSPORDER_NO
		,MTR.DSPORDER_NO AS MATER_DSPORDER_NO
		,MSD.DSPORDER_NO AS STD_DSPORDER_NO
		,PD.DSPORDER_NO AS PDMETER_DSPORDER_NO
	FROM
        (SELECT
		     MTRP.CUST_CODE
		    groupShipNo
            ,MTRP.DRAW_TYPE AS DRAW_TYPE
            ,SUM(TS.AMT_QTY*D.CS_QTY) AS AMT_QTY
            ,TS.LCLS_CODE
            ,TS.MCLS_CODE
            ,TS.TYPE_CODE
            ,TS.MATER_CODE
            ,TS.PDMETER
            ,TS.STD_CODE
            ,TS.PRVS_TYPE
            ,TS.SIZE_NAME
        FROM
		   (select* from TR_PIPEH  $WHERE)AS MTRP
		    INNER JOIN (select * from TR_PIPES where ( LCLS_CODE = '1' AND MCLS_CODE != '14' AND MCLS_CODE != '15' AND MCLS_CODE != '18' ) or LCLS_CODE = '2' )AS TS ON MTRP.MN_NO =  TS.MN_NO AND MTRP.MN_DATE =  TS.MN_DATE
       		INNER JOIN TR_PIPED D ON (TS.MN_DATE = D.MN_DATE AND TS.MN_NO = D.MN_NO AND TS.PAGE_NO = D.PAGE_NO AND TS.TANDB_TYPE = D.TANDB_TYPE)
        GROUP BY
                MTRP.CUST_CODE
                groupShipNo
                ,MTRP.DRAW_TYPE
                ,TS.LCLS_CODE
                ,TS.MCLS_CODE
                ,TS.TYPE_CODE
                ,TS.MATER_CODE
                ,TS.PDMETER
                ,TS.STD_CODE
                ,TS.SIZE_NAME
                ,TS.PRVS_TYPE
				) AS M
    LEFT JOIN M_CUST AS MT ON M.CUST_CODE = MT.CUST_CODE
    LEFT JOIN M_LCLS AS LCLS ON LCLS.LCLS_CODE = M.LCLS_CODE
    LEFT JOIN (select * from M_NAME where NAMECLS_CODE = 'TTL' AND DSP_FLG ='0') AS ME ON MT.TTL_CODE =  ME.NAME_CODE
    LEFT JOIN (select * from M_NAME where NAMECLS_CODE = 'DRAW' AND DSP_FLG ='0') AS MW ON M.DRAW_TYPE =  MW.NAME_CODE
    LEFT JOIN (select * from M_NAME where NAMECLS_CODE = 'PDMETER ' AND DSP_FLG ='0') AS PD ON M.PDMETER =  PD.NAME_CODE
    LEFT JOIN M_MCLS AS MCLS ON M.LCLS_CODE = MCLS.LCLS_CODE AND M.MCLS_CODE = MCLS.MCLS_CODE
    LEFT JOIN M_TYPE AS MTE ON MTE.TYPE_CODE =  M.TYPE_CODE
    LEFT JOIN M_STD AS MSD ON MSD.STD_CODE =  M.STD_CODE
    LEFT JOIN M_MATER AS MTR ON MTR.MATER_CODE =  M.MATER_CODE
    LEFT JOIN M_SPPROD AS MD ON M.LCLS_CODE = MD.LCLS_CODE AND M.MCLS_CODE = MD.MCLS_CODE
    LEFT JOIN M_SUPP AS MP ON MP.SUPP_CODE = MD.SUPP1_CODE
	</M_REPORT0012>
	
	<M_REPORT0012_1>
		SELECT
		COALESCE(MT.CUST_CODE,'') AS CUST_CODE
		,COALESCE(MT.CUST1_NAME,'') AS CUST1_NAME
		,COALESCE(MT.CUSTR_NAME,'') AS CUSTR_NAME
		selectShipNo
		,COALESCE(MW.NAME_NAME,'') AS DRAW_TYPE
		,COALESCE(MCLS.MCLS_NAME,'') AS MCLS_NAME
		,COALESCE(LCLS.LCLS_NAME,'') AS LCLS_NAME
        ,COALESCE(M.PDMETER,'') AS PDMETER
        ,COALESCE(MTE.TYPE_NAME,'') AS TYPE_NAME
        ,COALESCE(MSD.STD_NAME,'') AS STD_NAME
        ,COALESCE(MTR.MATER_TNAME,'') AS MATER_NAME
        ,COALESCE(M.SIZE_NAME,'') AS SIZE_NAME
        ,COALESCE(M.AMT_QTY,0) AS AMT_QTY
		,COALESCE(MP.SUPPR_NAME,'') AS SUPPR_NAME
		,COALESCE(M.PRVS_TYPE,'') AS PRVS_TYPE
        ,(SELECT
			SUM(ORDR_QTY)
		FROM
			TR_ORDRD OD
			INNER JOIN TR_ORDRH OH ON (OD.ORDR_NO = OH.ORDR_NO AND OD.MN_DATE = OH.MN_DATE AND OD.CUST_CODE = OH.CUST_CODE AND OD.DRAW_TYPE = OH.DRAW_TYPE )
		WHERE
			OD.CUST_CODE = M.CUST_CODE
			AND
			joinSHipNo
			AND
			OD.DRAW_TYPE = M.DRAW_TYPE
			AND
			OD.LCLS_CODE = M.LCLS_CODE
			AND
			OD.MCLS_CODE = M.MCLS_CODE
			AND
			OD.TYPE_CODE = M.TYPE_CODE
			AND
			OD.PDMETER = M.PDMETER
			AND
			OD.MATER_CODE = M.MATER_CODE
			AND
			OD.STD_CODE = M.STD_CODE
			AND
			OD.SIZE_NAME = M.SIZE_NAME
		    strConditionSumOrdr
		) AS ORDR_QTY
		,M.LCLS_CODE
		,M.MCLS_CODE
		,M.TYPE_CODE
		,M.MATER_CODE
		,M.PDMETER
		,M.STD_CODE
		,MTE.DSPORDER_NO AS TYPE_DSPORDER_NO
		,MTR.DSPORDER_NO AS MATER_DSPORDER_NO
		,MSD.DSPORDER_NO AS STD_DSPORDER_NO
		,PD.DSPORDER_NO AS PDMETER_DSPORDER_NO
	FROM
        (SELECT
		     MTRP.CUST_CODE
		    groupShipNo
            ,MTRP.DRAW_TYPE AS DRAW_TYPE
            ,SUM(TS.AMT_QTY) AS AMT_QTY
            ,TS.LCLS_CODE
            ,TS.MCLS_CODE
            ,TS.TYPE_CODE
            ,TS.MATER_CODE
            ,TS.PDMETER
            ,TS.STD_CODE
            ,TS.PRVS_TYPE
            ,TS.SIZE_NAME
        FROM
		   (select* from TR_PIPEH  $WHERE)AS MTRP
		    INNER JOIN (select * from TR_PIPES where ( LCLS_CODE = '1' AND MCLS_CODE != '14' AND MCLS_CODE != '15' AND MCLS_CODE != '18' ) or LCLS_CODE = '2' )AS TS ON MTRP.MN_NO =  TS.MN_NO AND MTRP.MN_DATE =  TS.MN_DATE
        GROUP BY
                MTRP.CUST_CODE
                groupShipNo
                ,MTRP.DRAW_TYPE
                ,TS.LCLS_CODE
                ,TS.MCLS_CODE
                ,TS.TYPE_CODE
                ,TS.MATER_CODE
                ,TS.PDMETER
                ,TS.STD_CODE
                ,TS.SIZE_NAME
                ,TS.PRVS_TYPE
				) AS M
    LEFT JOIN M_CUST AS MT ON M.CUST_CODE = MT.CUST_CODE
    LEFT JOIN M_LCLS AS LCLS ON LCLS.LCLS_CODE = M.LCLS_CODE
    LEFT JOIN (select * from M_NAME where NAMECLS_CODE = 'TTL' AND DSP_FLG ='0') AS ME ON MT.TTL_CODE =  ME.NAME_CODE
    LEFT JOIN (select * from M_NAME where NAMECLS_CODE = 'DRAW' AND DSP_FLG ='0') AS MW ON M.DRAW_TYPE =  MW.NAME_CODE
    LEFT JOIN (select * from M_NAME where NAMECLS_CODE = 'PDMETER ' AND DSP_FLG ='0') AS PD ON M.PDMETER =  PD.NAME_CODE
    LEFT JOIN M_MCLS AS MCLS ON M.LCLS_CODE = MCLS.LCLS_CODE AND M.MCLS_CODE = MCLS.MCLS_CODE
    LEFT JOIN M_TYPE AS MTE ON MTE.TYPE_CODE =  M.TYPE_CODE
    LEFT JOIN M_STD AS MSD ON MSD.STD_CODE =  M.STD_CODE
    LEFT JOIN M_MATER AS MTR ON MTR.MATER_CODE =  M.MATER_CODE
    LEFT JOIN M_SPPROD AS MD ON M.LCLS_CODE = MD.LCLS_CODE AND M.MCLS_CODE = MD.MCLS_CODE
    LEFT JOIN M_SUPP AS MP ON MP.SUPP_CODE = MD.SUPP1_CODE
	</M_REPORT0012_1>
	
	
	<!-- add by PHUONGNT 2010.08.011 15h56 -->
	<M_REPORT00121>
	SELECT
		COALESCE(MT.CUST_CODE,'') AS CUST_CODE
		,COALESCE(MT.CUST1_NAME,'') AS CUST1_NAME
		,COALESCE(MT.CUSTR_NAME,'') AS CUSTR_NAME
		 selectShipNo
		,COALESCE(MW.NAME_NAME,'') AS DRAW_TYPE
		,COALESCE(MCLS.MCLS_NAME,'') AS MCLS_NAME
		,COALESCE(LCLS.LCLS_NAME,'') AS LCLS_NAME
        ,COALESCE(M.PDMETER,'') AS PDMETER
        ,COALESCE(MTE.TYPE_NAME,'') AS TYPE_NAME
        ,COALESCE(MSD.STD_NAME,'') AS STD_NAME
        ,COALESCE(MTR.MATER_TNAME,'') AS MATER_NAME
        ,COALESCE(M.SIZE_NAME,'') AS SIZE_NAME
        ,COALESCE(M.AMT_QTY,0) AS AMT_QTY
		,COALESCE(MP.SUPPR_NAME,'') AS SUPPR_NAME
		,COALESCE(M.PRVS_TYPE,'') AS PRVS_TYPE
        ,(SELECT
					SUM(ORDR_QTY)			
				FROM
					TR_ORDRD OD
					INNER JOIN TR_ORDRH OH ON (OD.ORDR_NO = OH.ORDR_NO AND OD.MN_DATE = OH.MN_DATE AND OD.CUST_CODE = OH.CUST_CODE AND OD.DRAW_TYPE = OH.DRAW_TYPE )
				WHERE				
					OD.CUST_CODE = M.CUST_CODE
					AND
					joinSHipNo
					AND
					OD.DRAW_TYPE = M.DRAW_TYPE
					AND
					OD.LCLS_CODE = M.LCLS_CODE
					AND
					OD.MCLS_CODE = M.MCLS_CODE
					AND
					OD.TYPE_CODE = M.TYPE_CODE
					AND
					OD.PDMETER = M.PDMETER
					AND
					OD.MATER_CODE = M.MATER_CODE
					AND
					OD.STD_CODE = M.STD_CODE
					AND
					OD.SIZE_NAME = M.SIZE_NAME
				    strConditionSumOrdr
				) AS ORDR_QTY		
		,COALESCE(LCLS.LCLS_CODE,'') AS LCLS_CODE
		,COALESCE(MCLS.MCLS_CODE,'') AS MCLS_CODE
	FROM
        (SELECT
		     MTRP.CUST_CODE
		    groupShipNo
            ,MTRP.DRAW_TYPE AS DRAW_TYPE
            ,SUM(TS.AMT_QTY*D.CS_QTY) AS AMT_QTY
            ,TS.LCLS_CODE
            ,TS.MCLS_CODE
            ,TS.TYPE_CODE
            ,TS.MATER_CODE
            ,TS.PDMETER
            ,TS.STD_CODE
            ,TS.PRVS_TYPE
            ,TS.SIZE_NAME
        FROM
		   (select* from TR_PIPEH  $WHERE)AS MTRP
		    INNER JOIN (select * from TR_PIPES where LCLS_CODE = '1' or LCLS_CODE = '2' )AS TS ON MTRP.MN_NO =  TS.MN_NO AND MTRP.MN_DATE =  TS.MN_DATE
       		INNER JOIN TR_PIPED D ON (TS.MN_DATE = D.MN_DATE AND TS.MN_NO = D.MN_NO AND TS.PAGE_NO = D.PAGE_NO AND TS.TANDB_TYPE = D.TANDB_TYPE)
        GROUP BY
                MTRP.CUST_CODE
                groupShipNo
                ,MTRP.DRAW_TYPE
                ,TS.LCLS_CODE
                ,TS.MCLS_CODE
                ,TS.TYPE_CODE
                ,TS.MATER_CODE
                ,TS.PDMETER
                ,TS.STD_CODE
                ,TS.SIZE_NAME
                ,TS.PRVS_TYPE
				) AS M
    LEFT JOIN M_CUST AS MT ON M.CUST_CODE = MT.CUST_CODE
    LEFT JOIN M_LCLS AS LCLS ON LCLS.LCLS_CODE = M.LCLS_CODE
    LEFT JOIN (select * from M_NAME where NAMECLS_CODE = 'TTL' AND DSP_FLG ='0') AS ME ON MT.TTL_CODE =  ME.NAME_CODE
    LEFT JOIN (select * from M_NAME where NAMECLS_CODE = 'DRAW' AND DSP_FLG ='0') AS MW ON M.DRAW_TYPE =  MW.NAME_CODE
    LEFT JOIN (select * from M_NAME where NAMECLS_CODE = 'PDMETER ' AND DSP_FLG ='0') AS PD ON M.PDMETER =  PD.NAME_CODE
    LEFT JOIN M_MCLS AS MCLS ON M.LCLS_CODE = MCLS.LCLS_CODE AND M.MCLS_CODE = MCLS.MCLS_CODE
    LEFT JOIN M_TYPE AS MTE ON MTE.TYPE_CODE =  M.TYPE_CODE
    LEFT JOIN M_STD AS MSD ON MSD.STD_CODE =  M.STD_CODE
    LEFT JOIN M_MATER AS MTR ON MTR.MATER_CODE =  M.MATER_CODE
    LEFT JOIN M_SPPROD AS MD ON M.LCLS_CODE = MD.LCLS_CODE AND M.MCLS_CODE = MD.MCLS_CODE
    LEFT JOIN M_SUPP AS MP ON MP.SUPP_CODE = MD.SUPP1_CODE
	</M_REPORT00121>
	<M_REPORT00121_1>
			SELECT
		COALESCE(MT.CUST_CODE,'') AS CUST_CODE
		,COALESCE(MT.CUST1_NAME,'') AS CUST1_NAME
		,COALESCE(MT.CUSTR_NAME,'') AS CUSTR_NAME
		selectShipNo
		,COALESCE(MW.NAME_NAME,'') AS DRAW_TYPE
		,COALESCE(MCLS.MCLS_NAME,'') AS MCLS_NAME
		,COALESCE(LCLS.LCLS_NAME,'') AS LCLS_NAME
        ,COALESCE(M.PDMETER,'') AS PDMETER
        ,COALESCE(MTE.TYPE_NAME,'') AS TYPE_NAME
        ,COALESCE(MSD.STD_NAME,'') AS STD_NAME
        ,COALESCE(MTR.MATER_TNAME,'') AS MATER_NAME
        ,COALESCE(M.SIZE_NAME,'') AS SIZE_NAME
        ,COALESCE(M.AMT_QTY,0) AS AMT_QTY
		,COALESCE(MP.SUPPR_NAME,'') AS SUPPR_NAME
		,COALESCE(M.PRVS_TYPE,'') AS PRVS_TYPE
        ,(SELECT
					SUM(ORDR_QTY)			
				FROM
					TR_ORDRD OD
					INNER JOIN TR_ORDRH OH ON (OD.ORDR_NO = OH.ORDR_NO AND OD.MN_DATE = OH.MN_DATE AND OD.CUST_CODE = OH.CUST_CODE AND OD.DRAW_TYPE = OH.DRAW_TYPE )
				WHERE				
					OD.CUST_CODE = M.CUST_CODE
					AND
					joinSHipNo
					AND
					OD.DRAW_TYPE = M.DRAW_TYPE
					AND
					OD.LCLS_CODE = M.LCLS_CODE
					AND
					OD.MCLS_CODE = M.MCLS_CODE
					AND
					OD.TYPE_CODE = M.TYPE_CODE
					AND
					OD.PDMETER = M.PDMETER
					AND
					OD.MATER_CODE = M.MATER_CODE
					AND
					OD.STD_CODE = M.STD_CODE
					AND
					OD.SIZE_NAME = M.SIZE_NAME
				    strConditionSumOrdr
				) AS ORDR_QTY		
		,COALESCE(LCLS.LCLS_CODE,'') AS LCLS_CODE
		,COALESCE(MCLS.MCLS_CODE,'') AS MCLS_CODE
	FROM
        (SELECT
		     MTRP.CUST_CODE
		    groupShipNo
            ,MTRP.DRAW_TYPE AS DRAW_TYPE
            ,SUM(TS.AMT_QTY) AS AMT_QTY
            ,TS.LCLS_CODE
            ,TS.MCLS_CODE
            ,TS.TYPE_CODE
            ,TS.MATER_CODE
            ,TS.PDMETER
            ,TS.STD_CODE
            ,TS.PRVS_TYPE
            ,TS.SIZE_NAME
        FROM
		   (select* from TR_PIPEH  $WHERE)AS MTRP
		    INNER JOIN (select * from TR_PIPES where LCLS_CODE = '1' or LCLS_CODE = '2' )AS TS ON MTRP.MN_NO =  TS.MN_NO AND MTRP.MN_DATE =  TS.MN_DATE
        GROUP BY
                MTRP.CUST_CODE
                groupShipNo
                ,MTRP.DRAW_TYPE
                ,TS.LCLS_CODE
                ,TS.MCLS_CODE
                ,TS.TYPE_CODE
                ,TS.MATER_CODE
                ,TS.PDMETER
                ,TS.STD_CODE
                ,TS.SIZE_NAME
                ,TS.PRVS_TYPE
				) AS M
    LEFT JOIN M_CUST AS MT ON M.CUST_CODE = MT.CUST_CODE
    LEFT JOIN M_LCLS AS LCLS ON LCLS.LCLS_CODE = M.LCLS_CODE
    LEFT JOIN (select * from M_NAME where NAMECLS_CODE = 'TTL' AND DSP_FLG ='0') AS ME ON MT.TTL_CODE =  ME.NAME_CODE
    LEFT JOIN (select * from M_NAME where NAMECLS_CODE = 'DRAW' AND DSP_FLG ='0') AS MW ON M.DRAW_TYPE =  MW.NAME_CODE
    LEFT JOIN (select * from M_NAME where NAMECLS_CODE = 'PDMETER ' AND DSP_FLG ='0') AS PD ON M.PDMETER =  PD.NAME_CODE
    LEFT JOIN M_MCLS AS MCLS ON M.LCLS_CODE = MCLS.LCLS_CODE AND M.MCLS_CODE = MCLS.MCLS_CODE
    LEFT JOIN M_TYPE AS MTE ON MTE.TYPE_CODE =  M.TYPE_CODE
    LEFT JOIN M_STD AS MSD ON MSD.STD_CODE =  M.STD_CODE
    LEFT JOIN M_MATER AS MTR ON MTR.MATER_CODE =  M.MATER_CODE
    LEFT JOIN M_SPPROD AS MD ON M.LCLS_CODE = MD.LCLS_CODE AND M.MCLS_CODE = MD.MCLS_CODE
    LEFT JOIN M_SUPP AS MP ON MP.SUPP_CODE = MD.SUPP1_CODE
	</M_REPORT00121_1>
	
	<M_REPORT00121_2>
		SELECT
				S.MN_NO,
				S.MN_DATE,
				S.PAGE_NO,
				S.[TANDB_TYPE],
				TANDB.NAME_NAME AS [TANDB_NAME],
				S.[GYO_NO],
				S.[PROC_TYPE],
				PROCT.NAME_NAME AS [PROC_NAME],
				S.[LCLS_CODE],
				LCLS.LCLS_NAME,
				S.[MCLS_CODE],
				MCLS.MCLS_NAME,
				S.[SCLS_CODE],
				SCLS.SCLS_NAME,
				S.[TYPE_CODE],
				MTYPE.TYPE_NAME,
				S.[PDMETER],
				PDMET.NAME_NAME AS [PDMETER_NAME],
				S.[MATER_CODE],
				MATER.MATER_TNAME,
				S.[STD_CODE],
				MSTD.STD_NAME,
			    S.[SIZE_NAME],
				S.LEN_QTY,
				CASE
        			WHEN S.LEN_QTY > S.LENMK_QTY THEN S.LEN_QTY
        			ELSE S.LENMK_QTY
    			END AS LENMK_QTY,
				S.AMT_QTY,
				S.TEMP_TYPE,
				S.PRVS_TYPE,
				S.ADD_USER,
				S.ADD_PC,
				S.ADD_DATE,
				S.ADD_TIME,
				S.LASTUP_USER,
				S.LASTUP_PC,
				S.LASTUP_DATE,
				S.LASTUP_TIME,
				0 as STT,
				0 as KQDH,
				0 as SUPP_TYPE,
				D.CS_QTY,
				M.CUST_CODE,
				(SELECT CUSTR_NAME FROM M_CUST WHERE M.CUST_CODE = CUST_CODE) AS CUSTR_NAME,
				M.BLOCK_NAME,
				M.DRAW_NO,
				MCLS.SUS_TYPE AS MCLS_SUSTYPE,
				MCUST.OODR_TYPE AS CUST_OODRTYPE,				
				MPROC.NAME_NAME AS PROC_NAME,
				M.SIGN_NO,
				M.BLOCK_NAME,
				M.DRAW_NO
		FROM
			TR_PIPES S INNER JOIN TR_PIPED D ON (S.MN_DATE = D.MN_DATE AND S.MN_NO = D.MN_NO AND S.PAGE_NO = D.PAGE_NO AND S.TANDB_TYPE = D.TANDB_TYPE)
					   INNER JOIN TR_PIPEH M ON (S.MN_DATE = M.MN_DATE AND S.MN_NO = M.MN_NO)
					   LEFT JOIN  M_NAME TANDB ON (TANDB.NAMECLS_CODE = 'TANDB'   AND TANDB.NAME_CODE = S.TANDB_TYPE)
					   LEFT JOIN  M_NAME PROCT ON (PROCT.NAMECLS_CODE = 'PROC'    AND PROCT.NAME_CODE = S.PROC_TYPE)
					   LEFT JOIN  M_NAME PDMET ON (PDMET.NAMECLS_CODE = 'PDMETER' AND PDMET.NAME_CODE = S.PDMETER)
					   LEFT JOIN  M_TYPE MTYPE ON (MTYPE.TYPE_CODE = S.TYPE_CODE)
					   LEFT JOIN  M_MATER MATER ON (MATER.MATER_CODE = S.MATER_CODE)
					   LEFT JOIN  M_STD MSTD ON (MSTD.STD_CODE = S.STD_CODE)
					   LEFT JOIN  M_LCLS LCLS ON (LCLS.LCLS_CODE = S.LCLS_CODE)
					   LEFT JOIN  M_MCLS MCLS ON (MCLS.LCLS_CODE = S.LCLS_CODE AND MCLS.MCLS_CODE = S.MCLS_CODE)
					   LEFT JOIN  M_SCLS SCLS ON (SCLS.LCLS_CODE = S.LCLS_CODE AND SCLS.MCLS_CODE = S.MCLS_CODE AND SCLS.SCLS_CODE = S.SCLS_CODE)
					   LEFT JOIN  M_CUST MCUST ON (MCUST.CUST_CODE = M.CUST_CODE)
					   LEFT JOIN M_SPPROD AS MSPPROD ON S.LCLS_CODE = MSPPROD.LCLS_CODE AND S.MCLS_CODE = MSPPROD.MCLS_CODE
					   LEFT JOIN M_SUPP AS MSUPP ON MSUPP.SUPP_CODE = MSPPROD.SUPP1_CODE
					   INNER JOIN (select * from M_NAME where NAMECLS_CODE = 'PROC' AND DSP_FLG ='0') AS MPROC ON RTRIM(S.PROC_TYPE) =  RTRIM(MPROC.NAME_CODE)
		strCondition
		ORDER BY S.PRVS_TYPE, S.MCLS_CODE, S.MATER_CODE DESC, S.TYPE_CODE, S.PDMETER, S.STD_CODE, S.SIZE_NAME, S.LEN_QTY
	</M_REPORT00121_2>
	
	<!--Add by HUNG NV 2010.10.04-->
	<M_REPORT0012_2>
			SELECT
				S.MN_NO,
				S.MN_DATE,
				S.PAGE_NO,
				S.[TANDB_TYPE],
				TANDB.NAME_NAME AS [TANDB_NAME],
				S.[GYO_NO],
				S.[PROC_TYPE],
				PROCT.NAME_NAME AS [PROC_NAME],
				S.[LCLS_CODE],
				LCLS.LCLS_NAME,
				S.[MCLS_CODE],
				MCLS.MCLS_NAME,
				S.[SCLS_CODE],
				SCLS.SCLS_NAME,
				S.[TYPE_CODE],
				MTYPE.TYPE_NAME,
				S.[PDMETER],
				PDMET.NAME_NAME AS [PDMETER_NAME],
				S.[MATER_CODE],
				MATER.MATER_TNAME,
				S.[STD_CODE],
				MSTD.STD_NAME,
			    S.[SIZE_NAME],
				S.LEN_QTY,
				CASE
        			WHEN S.LEN_QTY > S.LENMK_QTY THEN S.LEN_QTY
        			ELSE S.LENMK_QTY
    			END AS LENMK_QTY,
				S.AMT_QTY,
				S.TEMP_TYPE,
				S.PRVS_TYPE,
				S.ADD_USER,
				S.ADD_PC,
				S.ADD_DATE,
				S.ADD_TIME,
				S.LASTUP_USER,
				S.LASTUP_PC,
				S.LASTUP_DATE,
				S.LASTUP_TIME,
				0 as STT,
				0 as KQDH,
				0 as SUPP_TYPE,
				D.CS_QTY,
				M.CUST_CODE,
				(SELECT CUSTR_NAME FROM M_CUST WHERE M.CUST_CODE = CUST_CODE) AS CUSTR_NAME,
				M.BLOCK_NAME,
				M.DRAW_NO,
				MCLS.SUS_TYPE AS MCLS_SUSTYPE,
				MCUST.OODR_TYPE AS CUST_OODRTYPE,
				MTYPE.DSPORDER_NO AS TYPE_DSPORDER_NO,
				MATER.DSPORDER_NO AS MATER_DSPORDER_NO,
				PDMET.DSPORDER_NO AS PDMETER_DSPORDER_NO,
				(SELECT
					SUM(ORDR_QTY)
				FROM
					TR_ORDRD OD
					INNER JOIN TR_ORDRH OH ON (OD.ORDR_NO = OH.ORDR_NO AND OD.MN_DATE = OH.MN_DATE AND OD.CUST_CODE = OH.CUST_CODE AND OD.DRAW_TYPE = OH.DRAW_TYPE )
				WHERE
					OD.CUST_CODE = M.CUST_CODE
					AND
					OH.SHIP_NO = M.SHIP_NO
					AND
					OD.DRAW_TYPE = M.DRAW_TYPE
					AND
					OD.LCLS_CODE = S.LCLS_CODE
					AND
					OD.MCLS_CODE = S.MCLS_CODE
					AND
					OD.TYPE_CODE = S.TYPE_CODE
					AND
					OD.PDMETER = S.PDMETER
					AND
					OD.MATER_CODE = S.MATER_CODE
					AND
					OD.STD_CODE = S.STD_CODE
					AND
					OD.SIZE_NAME = S.SIZE_NAME
					AND
					OD.KIND_CODE  = CASE WHEN (S.LCLS_CODE != 0) THEN ''
										WHEN (S.LCLS_CODE = 0 AND MCLS.SUS_TYPE = 0) THEN ''
										WHEN (S.LCLS_CODE = 0 AND MCLS.SUS_TYPE = 1 AND S.LEN_QTY > (SELECT K.LENTO_QRY FROM M_KIND K WHERE K.KIND_CODE = 1)) THEN '2'
										ELSE '1'
								   END
				) AS SUM_ORDR,				
				MCUST.CUST1_NAME,
				MCUST.CUSTR_NAME,
				M.SHIP_NO,
				M.DRAW_TYPE,
				MSUPP.SUPPR_NAME
		FROM
			TR_PIPES S INNER JOIN TR_PIPED D ON (S.MN_DATE = D.MN_DATE AND S.MN_NO = D.MN_NO AND S.PAGE_NO = D.PAGE_NO AND S.TANDB_TYPE = D.TANDB_TYPE)
					   INNER JOIN TR_PIPEH M ON (S.MN_DATE = M.MN_DATE AND S.MN_NO = M.MN_NO)
					   LEFT JOIN  M_NAME TANDB ON (TANDB.NAMECLS_CODE = 'TANDB'   AND TANDB.NAME_CODE = S.TANDB_TYPE)
					   LEFT JOIN  M_NAME PROCT ON (PROCT.NAMECLS_CODE = 'PROC'    AND PROCT.NAME_CODE = S.PROC_TYPE)
					   LEFT JOIN  M_NAME PDMET ON (PDMET.NAMECLS_CODE = 'PDMETER' AND PDMET.NAME_CODE = S.PDMETER)
					   LEFT JOIN  M_TYPE MTYPE ON (MTYPE.TYPE_CODE = S.TYPE_CODE)
					   LEFT JOIN  M_MATER MATER ON (MATER.MATER_CODE = S.MATER_CODE)
					   LEFT JOIN  M_STD MSTD ON (MSTD.STD_CODE = S.STD_CODE)
					   LEFT JOIN  M_LCLS LCLS ON (LCLS.LCLS_CODE = S.LCLS_CODE)
					   LEFT JOIN  M_MCLS MCLS ON (MCLS.LCLS_CODE = S.LCLS_CODE AND MCLS.MCLS_CODE = S.MCLS_CODE)
					   LEFT JOIN  M_SCLS SCLS ON (SCLS.LCLS_CODE = S.LCLS_CODE AND SCLS.MCLS_CODE = S.MCLS_CODE AND SCLS.SCLS_CODE = S.SCLS_CODE)
					   LEFT JOIN  M_CUST MCUST ON (MCUST.CUST_CODE = M.CUST_CODE)
					   LEFT JOIN M_SPPROD AS MSPPROD ON S.LCLS_CODE = MSPPROD.LCLS_CODE AND S.MCLS_CODE = MSPPROD.MCLS_CODE
					   LEFT JOIN M_SUPP AS MSUPP ON MSUPP.SUPP_CODE = MSPPROD.SUPP1_CODE
		strCondition
		ORDER BY S.PRVS_TYPE, S.MCLS_CODE, S.MATER_CODE DESC, S.TYPE_CODE, S.PDMETER, S.STD_CODE, S.SIZE_NAME, S.LEN_QTY
	</M_REPORT0012_2>
	
	<M_REPORT014>
		    SELECT
                    MDATA.CUST_NAME,
                    MDATA.SHIP_NO,
                    MDATA.DRAW_NAME,
                    MDATA.SUPP_NAME,
                    MDATA.SUPP_CODE,
                    MDATA.LCLS_NAME,
                    MDATA.LCLS_CODE,
                    MDATA.MCLS_NAME,
                    MDATA.MCLS_CODE,
                    MDATA.TYPE_NAME,
                    MDATA.MATER_NAME,
                    MDATA.PDMETER,
                    MDATA.STD_NAME,
                    MDATA.STD_CODE,
                    MDATA.SIZE_NAME,
                    MDATA.TLL_NAME,
                    MDATA.SUPP_MNY,
                    MDATA.SUM_ORDRQTY,
                    MDATA.TYPE_CODE,
                    MDATA.MATER_CODE,
                    MMTYPE.DSPORDER_NO,
                    MMATER.DSPORDER_NO,
                    MSTD.DSPORDER_NO,
                    MPDE.DSPORDER_NO
           FROM
           ( select
		    MC.CUST1_NAME AS CUST_NAME,
		    orh.SHIP_NO AS SHIP_NO,
		    MNA.NAME_NAME AS DRAW_NAME,
		    SP.SUPP1_NAME AS SUPP_NAME,
		    SP.SUPP_CODE AS SUPP_CODE,
		    ML.LCLS_NAME AS LCLS_NAME,
            	    ML.LCLS_CODE AS LCLS_CODE,
		    MM.MCLS_TNAME AS MCLS_NAME,
            	    MM.MCLS_CODE AS MCLS_CODE,
		    MT.TYPE_NAME AS TYPE_NAME,
                    MT.TYPE_CODE AS TYPE_CODE,
		    MA.MATER_NAME AS MATER_NAME,
            	    MA.MATER_CODE AS MATER_CODE,
		    TRD.PDMETER AS PDMETER,
		    COALESCE(MS.STD_NAME,'')+ ' '+ COALESCE(MK.KIND_NAME,'') AS STD_NAME,
            	    MS.STD_CODE AS STD_CODE,
		    TRD.SIZE_NAME AS SIZE_NAME,
		    ME.NAME_NAME AS TLL_NAME,
		    COALESCE(max(
		    case SP.SUPPMNY_TYPE
			    when '1' then MP.SUPP1_MNY
			    when '2' then MP.SUPP2_MNY
			    when '3' then MP.SUPP3_MNY
			    when '4' then MP.SUPP4_MNY
			    when '5' then MP.SUPP5_MNY
			    when '6' then MP.SUPP6_MNY
			    when '7' then MP.SUPP7_MNY
			    when '8' then MP.SUPP8_MNY
			    when '9' then MP.SUPP9_MNY
			    when '10' then MP.SUPP10_MNY
		    	else 0
		    end),0) as SUPP_MNY,
		sum(TRD.ORDR_QTY) as SUM_ORDRQTY
	from TR_ORDRD TRD
	left join TR_ORDRH as orh on TRD.ORDR_NO = orh.ORDR_NO and TRD.MN_DATE = orh.MN_DATE and TRD.CUST_CODE = orh.CUST_CODE and TRD.DRAW_TYPE = orh.DRAW_TYPE
	left join M_SUPP AS SP on TRD.SUPP_CODE = SP.SUPP_CODE
	left join M_LCLS AS ML on TRD.LCLS_CODE = ML.LCLS_CODE
	left join M_MCLS as MM on TRD.LCLS_CODE = MM.lCLS_CODE and TRD.MCLS_CODE = MM.MCLS_CODE
	left join M_TYPE AS MT on TRD.TYPE_CODE = MT.TYPE_CODE
	left join M_MATER AS MA on TRD.MATER_CODE = MA.MATER_CODE
	left join M_STD AS MS on TRD.STD_CODE = MS.STD_CODE
	LEFT JOIN M_KIND AS MK ON MK.KIND_CODE =  TRD.KIND_CODE
	left join M_CUST AS MC ON orh.CUST_CODE = MC.CUST_CODE
	left join (select * from M_NAME where NAMECLS_CODE = 'TTL' AND DSP_FLG ='0') AS ME ON MC.TTL_CODE =  ME.NAME_CODE
	left join (select * from M_NAME where NAMECLS_CODE = 'DRAW' AND DSP_FLG ='0') AS MNA ON MNA.NAME_CODE = orh.DRAW_TYPE
	left join 

	(SELECT MAX(SUPP1_MNY) AS SUPP1_MNY, MAX(SUPP2_MNY) AS SUPP2_MNY, MAX(SUPP3_MNY) AS SUPP3_MNY, MAX(SUPP4_MNY) AS SUPP4_MNY, MAX(SUPP5_MNY) AS SUPP5_MNY, MAX(SUPP6_MNY) AS SUPP6_MNY, MAX(SUPP7_MNY) AS SUPP7_MNY, MAX(SUPP8_MNY) AS SUPP8_MNY, MAX(SUPP9_MNY) AS SUPP9_MNY, MAX(SUPP10_MNY) AS SUPP10_MNY, LCLS_CODE, MCLS_CODE, TYPE_CODE, MATER_CODE, PDMETER, STD_CODE, CUST_CODE, KIND_CODE, FREQTY FROM M_PROD
		GROUP BY LCLS_CODE, MCLS_CODE, TYPE_CODE, MATER_CODE, PDMETER, STD_CODE, CUST_CODE, KIND_CODE, FREQTY
	) MP ON MP.LCLS_CODE = TRD.LCLS_CODE AND MP.MCLS_CODE = TRD.MCLS_CODE AND MP.TYPE_CODE = TRD.TYPE_CODE AND MP.MATER_CODE = TRD.MATER_CODE AND MP.PDMETER = TRD.PDMETER AND MP.STD_CODE = TRD.STD_CODE
									AND RTRIM(MP.CUST_CODE) = CASE
									WHEN (RTRIM(MM.SPCL_TYPE) = '1' OR RTRIM(MM.SPCL_TYPE) = '3' ) THEN RTRIM(MC.CUST_CODE)
									ELSE ''
									END
									AND MP.KIND_CODE = TRD.KIND_CODE
									AND MP.FREQTY = 0   
	
	$WHERE
	group by
	mc.CUST1_NAME, me.NAME_NAME,MNA.NAME_NAME,orh.SHIP_NO,sp.SUPP_CODE,sp.SUPP1_name, ml.LCLS_name, ml.LCLS_CODE, mm.MCLS_TNAME, mm.MCLS_CODE, mt.TYPE_name, mt.TYPE_CODE, ma.MATER_name, ma.MATER_CODE, TRD.PDMETER, ms.STD_name,ms.STD_CODE , MK.KIND_NAME,TRD.SIZE_NAME
     ) AS MDATA

     LEFT JOIN M_TYPE AS MMTYPE on MMTYPE.TYPE_CODE= MDATA.TYPE_CODE
     LEFT JOIN M_MATER AS MMATER on MMATER.MATER_CODE = MDATA.MATER_CODE
     LEFT JOIN M_STD AS MSTD on MSTD.STD_CODE = MDATA.STD_CODE
     LEFT JOIN (select * from M_NAME where NAMECLS_CODE = 'PDMETER' AND DSP_FLG ='0') AS MPDE ON MDATA.PDMETER =  MPDE.NAME_CODE
     Order By MDATA.SUPP_CODE,MDATA.LCLS_CODE, MDATA.MCLS_CODE, MMTYPE.DSPORDER_NO, MMATER.DSPORDER_NO, MSTD.DSPORDER_NO, MPDE.DSPORDER_NO, MDATA.SIZE_NAME

	</M_REPORT014>

	<!-- add by HUNG NV 2010.08.09 13h56 -->
	<M_REPORT501>
		SELECT
			b.MCLS_NAME,
			c.TYPE_NAME,
			d.NAME_NAME AS PDMETER_NAME,
			e.MATER_NAME,
			COALESCE(f.STD_NAME,'')+ ' '+ COALESCE(KIND.KIND_NAME,'') AS STD_NAME,
			a.SIZE_NAME,
			a.ORDR_QTY,
			a.PRVS_TYPE,
			a.SUPP_CODE,
			CASE
				WHEN a.PRVS_TYPE = '1' THEN (SELECT CUST1_NAME FROM M_CUST WHERE a.SUPP_CODE = CUST_CODE)
				WHEN a.PRVS_TYPE = '0' THEN (SELECT SUPP1_NAME FROM M_SUPP WHERE a.SUPP_CODE = SUPP_CODE)
				ELSE ''
			END 'SUPP_NAME',
			CASE
				WHEN a.PRVS_TYPE = '1' THEN (SELECT mn.NAME_NAME FROM M_CUST mc INNER JOIN M_NAME mn ON (mc.TTL_CODE = mn.NAME_CODE AND mn.NAMECLS_CODE = 'TTL' ) WHERE a.SUPP_CODE = CUST_CODE)
				WHEN a.PRVS_TYPE = '0' THEN (SELECT mn.NAME_NAME FROM M_SUPP ms INNER JOIN M_NAME mn ON (ms.TTL_CODE = mn.NAME_CODE AND mn.NAMECLS_CODE = 'TTL' ) WHERE a.SUPP_CODE = SUPP_CODE)
				ELSE ''
			END 'TTL_NAME'
		FROM
			TR_ORDRD a
				LEFT JOIN M_MCLS    b ON (a.LCLS_CODE = b.LCLS_CODE AND a.MCLS_CODE = b.MCLS_CODE)
				LEFT JOIN M_TYPE    c ON (a.TYPE_CODE = c.TYPE_CODE)
				LEFT JOIN M_NAME    d ON (a.PDMETER = d.NAME_CODE AND d.NAMECLS_CODE = 'PDMETER')
				LEFT JOIN M_MATER   e ON (a.MATER_CODE = e.MATER_CODE)
				LEFT JOIN M_STD	 f ON (a.STD_CODE = f.STD_CODE)
				LEFT JOIN TR_ORDRH  h ON (a.ORDR_NO = h.ORDR_NO AND a.MN_DATE = h.MN_DATE AND a.CUST_CODE = h.CUST_CODE AND a.DRAW_TYPE = h.DRAW_TYPE)
				LEFT JOIN M_KIND KIND ON (KIND.KIND_CODE = a.KIND_CODE)
		WHERE
				a.ORDR_NO = ?
				AND
				a.MN_DATE = ?
				AND
				a.CUST_CODE = ?
				AND
				a.DRAW_TYPE = ?
				strCondition
		ORDER BY a.PRVS_TYPE, a.SUPP_CODE, a.GYO_NO
	</M_REPORT501>


	<M_REPORT503>
			SELECT
				S.MN_NO,
				S.MN_DATE,
				S.PAGE_NO,
				S.[TANDB_TYPE],
				TANDB.NAME_NAME AS [TANDB_NAME],
				S.[GYO_NO],
				S.[PROC_TYPE],
				PROCT.NAME_NAME AS [PROC_NAME],
				S.[LCLS_CODE],
				LCLS.LCLS_NAME,
				S.[MCLS_CODE],
				MCLS.MCLS_NAME,
				S.[SCLS_CODE],
				SCLS.SCLS_NAME,
				S.[TYPE_CODE],
				MTYPE.TYPE_NAME,
				S.[PDMETER],
				PDMET.NAME_NAME AS [PDMETER_NAME],
				S.[MATER_CODE],
				MATER.MATER_TNAME,
				S.[STD_CODE],
				MSTD.STD_NAME,
			    S.[SIZE_NAME],
				S.LEN_QTY,
				CASE
        			WHEN S.LEN_QTY > S.LENMK_QTY THEN S.LEN_QTY
        			ELSE S.LENMK_QTY
    			END AS LENMK_QTY,
				S.AMT_QTY,
				S.TEMP_TYPE,
				S.PRVS_TYPE,
				S.ADD_USER,
				S.ADD_PC,
				S.ADD_DATE,
				S.ADD_TIME,
				S.LASTUP_USER,
				S.LASTUP_PC,
				S.LASTUP_DATE,
				S.LASTUP_TIME,
				0 as STT,
				0 as KQDH,
				0 as SUPP_TYPE,
				D.CS_QTY,
				M.CUST_CODE,
				(SELECT CUSTR_NAME FROM M_CUST WHERE M.CUST_CODE = CUST_CODE) AS CUSTR_NAME,
				M.BLOCK_NAME,
				M.DRAW_NO,
				MCLS.SUS_TYPE AS MCLS_SUSTYPE,
				MCUST.OODR_TYPE AS CUST_OODRTYPE,
				MTYPE.DSPORDER_NO AS TYPE_DSPORDER_NO,
				MATER.DSPORDER_NO AS MATER_DSPORDER_NO,
				MSTD.DSPORDER_NO AS STD_DSPORDER_NO,
				PDMET.DSPORDER_NO AS PDMETER_DSPORDER_NO,
				(SELECT
					SUM(ORDR_QTY)
				FROM
					TR_ORDRD OD
					INNER JOIN TR_ORDRH OH ON (OD.ORDR_NO = OH.ORDR_NO AND OD.MN_DATE = OH.MN_DATE AND OD.CUST_CODE = OH.CUST_CODE AND OD.DRAW_TYPE = OH.DRAW_TYPE )
				WHERE
					OD.CUST_CODE = M.CUST_CODE
					AND
					OH.SHIP_NO = M.SHIP_NO
					AND
					OD.DRAW_TYPE = M.DRAW_TYPE
					AND
					OD.LCLS_CODE = S.LCLS_CODE
					AND
					OD.MCLS_CODE = S.MCLS_CODE
					AND
					OD.TYPE_CODE = S.TYPE_CODE
					AND
					OD.PDMETER = S.PDMETER
					AND
					OD.MATER_CODE = S.MATER_CODE
					AND
					OD.STD_CODE = S.STD_CODE
					AND
					OD.SIZE_NAME = S.SIZE_NAME
					AND
					OD.KIND_CODE  = CASE WHEN (S.LCLS_CODE != 0) THEN ''
										WHEN (S.LCLS_CODE = 0 AND MCLS.SUS_TYPE = 0) THEN ''
										WHEN (S.LCLS_CODE = 0 AND MCLS.SUS_TYPE = 1 AND S.LEN_QTY > (SELECT K.LENTO_QRY FROM M_KIND K WHERE K.KIND_CODE = 1)) THEN '2'
										ELSE '1'
								   END
					strConditionSumOrdr
				) AS SUM_ORDR
		FROM
			TR_PIPES S INNER JOIN TR_PIPED D ON (S.MN_DATE = D.MN_DATE AND S.MN_NO = D.MN_NO AND S.PAGE_NO = D.PAGE_NO AND S.TANDB_TYPE = D.TANDB_TYPE)
					   INNER JOIN TR_PIPEH M ON (S.MN_DATE = M.MN_DATE AND S.MN_NO = M.MN_NO)
					   LEFT JOIN  M_NAME TANDB ON (TANDB.NAMECLS_CODE = 'TANDB'   AND TANDB.NAME_CODE = S.TANDB_TYPE)
					   LEFT JOIN  M_NAME PROCT ON (PROCT.NAMECLS_CODE = 'PROC'    AND PROCT.NAME_CODE = S.PROC_TYPE)
					   LEFT JOIN  M_NAME PDMET ON (PDMET.NAMECLS_CODE = 'PDMETER' AND PDMET.NAME_CODE = S.PDMETER)
					   LEFT JOIN  M_TYPE MTYPE ON (MTYPE.TYPE_CODE = S.TYPE_CODE)
					   LEFT JOIN  M_MATER MATER ON (MATER.MATER_CODE = S.MATER_CODE)
					   LEFT JOIN  M_STD MSTD ON (MSTD.STD_CODE = S.STD_CODE)
					   LEFT JOIN  M_LCLS LCLS ON (LCLS.LCLS_CODE = S.LCLS_CODE)
					   LEFT JOIN  M_MCLS MCLS ON (MCLS.LCLS_CODE = S.LCLS_CODE AND MCLS.MCLS_CODE = S.MCLS_CODE)
					   LEFT JOIN  M_SCLS SCLS ON (SCLS.LCLS_CODE = S.LCLS_CODE AND SCLS.MCLS_CODE = S.MCLS_CODE AND SCLS.SCLS_CODE = S.SCLS_CODE)
					   LEFT JOIN  M_CUST MCUST ON (MCUST.CUST_CODE = M.CUST_CODE)
		strCondition
		ORDER BY S.PRVS_TYPE, S.MCLS_CODE, S.MATER_CODE DESC, S.TYPE_CODE, S.PDMETER, S.STD_CODE, S.SIZE_NAME, S.LEN_QTY DESC
	</M_REPORT503>

	

	<M_REPORT511>
		SELECT
			MC.CUSTR_NAME AS CUST_NAME
			,MM.MATER_TNAME AS MATER_NAME
			,MS.PDMETER AS PDMETER_NAME
			,PRCS.NAME_NAME AS PRCS_NAME
			,CASE LEN(M.HURRY_TYPE)
				WHEN 0 THEN M.DLVR_DATE
				ELSE M.HURRY_TYPE
			END HURRY_TYPE
			 ,CASE LEN(M.HURRY_TYPE)
				WHEN 0 THEN substring(convert(nvarchar(8), M.DLVR_DATE), 0, 5) + '年' + substring(convert(char(8), M.DLVR_DATE), 5, 2) + '月' + substring(convert(char(8), M.DLVR_DATE), 7, 2) + '日'
				ELSE HURRY.NAME_NAME
			END HURRY_NAME
			,M.SHIP_NO
			,DRAW.NAME_NAME AS DRAW_NAME
			,MKIN.NAME_PNAME AS MKIN_NAME
			,M.SIGN_NO
			,P.LEN_QTY
			,MS.CAL_QTY
			,MS.PRGYO_NO
			,P.PAGE_NO
			,ME.EMP_NAME AS ADD_USER
			,P.PIPE_NO
			,MS.TYPE_CODE
			,MTYPE.TYPE_NAME
			,M.CUST_CODE
			,MS.MATER_CODE
			,MS.PDMETER
			,P.PRCS_TYPE
			,M.DRAW_TYPE
			,CASE MS.TANDB_TYPE
				WHEN '1' THEN TANDB.NAME_TNAME
				ELSE ''
			END TANDB_NAME
			,T.GYO_NO AS PIPE_SIGN_GYO_NO
			,P.GYO_NO AS PIPE_GYO_NO
			,COALESCE(ADDS.NAME_PNAME,'') AS ADDS_NAME
		FROM
			TR_PIPEMT T
			JOIN TR_PIPEMS MS ON T.MN_NO = MS.MN_NO AND T.MN_DATE = MS.MN_DATE AND T.PAGE_NO = MS.PAGE_NO AND T.TANDB_TYPE = MS.TANDB_TYPE
			JOIN TR_PIPES S ON MS.MN_NO = S.MN_NO AND MS.MN_DATE = S.MN_DATE AND MS.PAGE_NO = S.PAGE_NO AND MS.TANDB_TYPE = S.TANDB_TYPE AND MS.GYO_NO = S.GYO_NO
			JOIN TR_PIPEMP P ON P.MN_NO = MS.MN_NO AND P.MN_DATE = MS.MN_DATE AND P.PAGE_NO = MS.PAGE_NO AND P.TANDB_TYPE = MS.TANDB_TYPE AND P.GYO_NO = MS.GYO_NO AND P.PIPE_NO = MS.PIPE_NO
			JOIN TR_PIPEH M ON  MS.MN_NO = M.MN_NO AND MS.MN_DATE = M.MN_DATE
			LEFT JOIN M_CUST MC ON M.CUST_CODE = MC.CUST_CODE
			LEFT JOIN M_EMP ME ON P.ADD_USER = ME.EMP_USER
			LEFT JOIN M_MATER MM ON MS.MATER_CODE = MM.MATER_CODE
			LEFT JOIN M_TYPE MTYPE ON MS.TYPE_CODE = MTYPE.TYPE_CODE
			LEFT JOIN M_NAME ADDS ON S.TEMP_TYPE = ADDS.NAME_CODE AND ADDS.NAMECLS_CODE = 'ADDS'
			LEFT JOIN M_NAME PRCS ON P.PRCS_TYPE = PRCS.NAME_CODE AND PRCS.NAMECLS_CODE = 'PRCS'
			LEFT JOIN M_NAME MKIN ON P.MKIN_TYPE = MKIN.NAME_CODE AND MKIN.NAMECLS_CODE = 'MKIN'
			LEFT JOIN M_NAME DRAW ON M.DRAW_TYPE = DRAW.NAME_CODE AND DRAW.NAMECLS_CODE = 'DRAW'
			LEFT JOIN M_NAME HURRY ON M.HURRY_TYPE = HURRY.NAME_CODE AND HURRY.NAMECLS_CODE = 'HURRY'
			LEFT JOIN M_NAME TANDB ON MS.TANDB_TYPE = TANDB.NAME_CODE AND TANDB.NAMECLS_CODE = 'TANDB'
		strCondition
		ORDER BY
			M.CUST_CODE
			,M.SHIP_NO
			,M.DRAW_TYPE
			,M.SIGN_NO
			,MS.PAGE_NO
			,MS.TANDB_TYPE
			,P.PIPE_NO
			,PIPE_GYO_NO
			,PIPE_SIGN_GYO_NO
			,MS.PRGYO_NO
	</M_REPORT511>

	<M_REPORT508>
		SELECT
			C.CUST_CODE,
			C.CUST1_NAME,
			C.TTL_NAME,
			C.SHIP_NO,
			C.DRAW_TYPE,

			C.DRAW_NAME,
			C.AFPR_TYPE,
			C.AFPR_NAME,
			C.SIGN_NO,
			C.BLOCK_NAME,

			C.DRAW_NO,
			C.BLOCK_NAME_DRAW_NO,
			C.BLOCK_NAME_DRAW_NO_NAME,
			C.LCLS_CODE,
			C.PROC_TYPE,

			C.PROC_NAME,
			C.DSPORDER_NO,
			C.TLEN_QTY,
			C.TCS_QTY
		FROM
		(
			(
			SELECT
				A.CUST_CODE,
				A.CUST1_NAME,
				A.TTL_NAME,
				A.SHIP_NO,
				A.DRAW_TYPE,

				A.DRAW_NAME,
				'' AS AFPR_TYPE,
				'' AS AFPR_NAME,
				A.SIGN_NO,
				A.BLOCK_NAME,

				A.DRAW_NO,
				A.BLOCK_NAME_DRAW_NO,
				A.BLOCK_NAME_DRAW_NO_NAME,
				A.LCLS_CODE,
				A.PROC_TYPE,

				A.PROC_NAME,
				A.DSPORDER_NO,
				SUM(A.TLEN_QTY) AS TLEN_QTY,
				SUM(A.TCS_QTY) AS TCS_QTY
	        FROM
	        (
					SELECT
						M.CUST_CODE,
						CUST.CUST1_NAME,
						TTL.NAME_NAME AS TTL_NAME,
						M.SHIP_NO,
						M.DRAW_TYPE,

						NAME_DRAW.NAME_NAME AS DRAW_NAME,
						'' AS AFPR_TYPE,
						'' AS AFPR_NAME,
						M.SIGN_NO,
						M.BLOCK_NAME,
						M.DRAW_NO,
						CASE
							WHEN CUST.WTOUT_TYPE = '0' THEN M.BLOCK_NAME
							WHEN CUST.WTOUT_TYPE = '1' THEN M.DRAW_NO
							ELSE ''
						END AS BLOCK_NAME_DRAW_NO,
						CASE
							WHEN CUST.WTOUT_TYPE = '0' THEN 'ブロック名'
							WHEN CUST.WTOUT_TYPE = '1' THEN '図番'
							ELSE ''
						END AS BLOCK_NAME_DRAW_NO_NAME,
						M.LCLS_CODE,
						M.PROC_TYPE,
						NAME_PROC.NAME_RNAME AS PROC_NAME,
						NAME_PROC.DSPORDER_NO,
						TLEN_QTY = CASE
	                            WHEN (M.LCLS_CODE = '0' AND M.KIND_CODE = '') THEN SUM(M.TLEN_QTY / (COALESCE(convert(int, MCTL.C_DATA), 5510) ) * M.WT_QTY)
	                            WHEN (M.LCLS_CODE = '0' AND M.KIND_CODE = '1') THEN SUM(M.TLEN_QTY / (COALESCE(convert(int, MKIND1.LENTO_QRY ), 4005) ) * M.WT_QTY)
	                            WHEN (M.LCLS_CODE = '0' AND M.KIND_CODE = '2') THEN SUM(M.TLEN_QTY / (COALESCE(convert(int, MKIND2.LENTO_QRY ), 6006) ) * M.WT_QTY)
	                            WHEN (M.LCLS_CODE = '1' AND M.MCLS_CODE = '14') THEN SUM(M.TLEN_QTY / (COALESCE(convert(int, MCTL.C_DATA), 5510) ) * M.WT_QTY )
	                            WHEN (M.LCLS_CODE = '1' AND M.MCLS_CODE = '15') THEN SUM(M.TLEN_QTY / (COALESCE(convert(int, MCTL.C_DATA), 5510) ) * M.WT_QTY )
	                            WHEN (M.LCLS_CODE = '1' AND M.MCLS_CODE = '18') THEN SUM(M.TLEN_QTY / (COALESCE(convert(int, MCTL.C_DATA), 5510) ) * M.WT_QTY)
	                            ELSE SUM(M.TCS_QTY * M.WT_QTY)
	                        END,
						SUM(M.TCS_QTY * M.WT_QTY) AS TCS_QTY
					FROM
						F_PIPESUM M
						LEFT JOIN M_NAME NAME_PROC ON M.PROC_TYPE = NAME_PROC.NAME_CODE AND NAME_PROC.NAMECLS_CODE = 'PROC'
						LEFT JOIN M_NAME NAME_DRAW ON M.DRAW_TYPE = NAME_DRAW.NAME_CODE AND NAME_DRAW.NAMECLS_CODE = 'DRAW'
						LEFT JOIN M_CUST CUST ON M.CUST_CODE = CUST.CUST_CODE
						LEFT JOIN M_NAME TTL ON (CUST.TTL_CODE = TTL.NAME_CODE AND TTL.NAMECLS_CODE = 'TTL')
						LEFT JOIN M_CTL MCTL ON (MCTL.C_KEY = 'PIPE_LEN' AND MCTL.USERID = 'SYSTEM')
	                    LEFT JOIN M_KIND MKIND1 ON (MKIND1.KIND_CODE = '1')
	                    LEFT JOIN M_KIND MKIND2 ON (MKIND2.KIND_CODE = '2')
	                strCondition
					GROUP BY
						M.CUST_CODE,
						CUST.CUST1_NAME,
						TTL.NAME_NAME,
						CUST.WTOUT_TYPE,
						M.SHIP_NO,

						M.DRAW_TYPE,
						NAME_DRAW.NAME_NAME,
						M.SIGN_NO,
						M.BLOCK_NAME,
						M.DRAW_NO,

						M.LCLS_CODE,
						M.MCLS_CODE,
						M.PROC_TYPE,
						NAME_PROC.NAME_RNAME,
						NAME_PROC.DSPORDER_NO,
						M.KIND_CODE
			)
			AS A
			GROUP BY
	            A.CUST_CODE,
	            A.CUST1_NAME,
	            A.TTL_NAME,
	            A.BLOCK_NAME_DRAW_NO,
	            A.BLOCK_NAME_DRAW_NO_NAME,

	            A.SHIP_NO,
	            A.DRAW_TYPE,
	            A.DRAW_NAME,
	            A.SIGN_NO,
	            A.BLOCK_NAME,

	            A.DRAW_NO,
	            A.LCLS_CODE,
	            A.PROC_TYPE,
	            A.PROC_NAME,
	            A.DSPORDER_NO
			)

			UNION ALL

			(
			SELECT
	            B.CUST_CODE,
	            B.CUST1_NAME,
	            B.TTL_NAME,
	            B.SHIP_NO,
	            B.DRAW_TYPE,

	            B.DRAW_NAME,
	            B.AFPR_TYPE,
	            B.AFPR_NAME,
	            B.SIGN_NO,
	            B.BLOCK_NAME,

	            B.DRAW_NO,
	            B.BLOCK_NAME_DRAW_NO,
	            B.BLOCK_NAME_DRAW_NO_NAME,
	            B.LCLS_CODE,
	            B.PROC_TYPE,

	            B.PROC_NAME,
	            B.DSPORDER_NO,
	            SUM(B.TLEN_QTY) AS TLEN_QTY,
	            SUM(B.TCS_QTY) AS TCS_QTY
	        FROM (

					SELECT
						M.CUST_CODE,
						CUST.CUST1_NAME,
						TTL.NAME_NAME AS TTL_NAME,
						M.SHIP_NO,
						M.DRAW_TYPE,
						NAME_DRAW.NAME_NAME AS DRAW_NAME,
						M.AFPR_TYPE,
						NAME_AFPR.NAME_NAME AS AFPR_NAME,
						M.SIGN_NO,
						M.BLOCK_NAME,
						M.DRAW_NO,
						CASE
							WHEN CUST.WTOUT_TYPE = '0' THEN M.BLOCK_NAME
							WHEN CUST.WTOUT_TYPE = '1' THEN M.DRAW_NO
							ELSE ''
						END AS BLOCK_NAME_DRAW_NO,
						CASE
							WHEN CUST.WTOUT_TYPE = '0' THEN 'ブロック名'
							WHEN CUST.WTOUT_TYPE = '1' THEN '図番'
							ELSE ''
						END AS BLOCK_NAME_DRAW_NO_NAME,
						M.LCLS_CODE,
						M.PROC_TYPE,
						NAME_PROC.NAME_RNAME AS PROC_NAME,
						NAME_PROC.DSPORDER_NO,
						TLEN_QTY = CASE
	                            WHEN (M.LCLS_CODE = '0' AND M.KIND_CODE = '') THEN SUM(M.TLEN_QTY / (COALESCE(convert(int, MCTL.C_DATA), 5510) ) * M.WT_QTY)
	                            WHEN (M.LCLS_CODE = '0' AND M.KIND_CODE = '1') THEN SUM(M.TLEN_QTY / (COALESCE(convert(int, MKIND1.LENTO_QRY ), 4005) ) * M.WT_QTY)
	                            WHEN (M.LCLS_CODE = '0' AND M.KIND_CODE = '2') THEN SUM(M.TLEN_QTY / (COALESCE(convert(int, MKIND2.LENTO_QRY ), 6006) ) * M.WT_QTY)
	                            WHEN (M.LCLS_CODE = '1' AND M.MCLS_CODE = '14') THEN SUM(M.TLEN_QTY / (COALESCE(convert(int, MCTL.C_DATA), 5510) ) * M.WT_QTY )
	                            WHEN (M.LCLS_CODE = '1' AND M.MCLS_CODE = '15') THEN SUM(M.TLEN_QTY / (COALESCE(convert(int, MCTL.C_DATA), 5510) ) * M.WT_QTY )
	                            WHEN (M.LCLS_CODE = '1' AND M.MCLS_CODE = '18') THEN SUM(M.TLEN_QTY / (COALESCE(convert(int, MCTL.C_DATA), 5510) ) * M.WT_QTY )
	                            ELSE SUM(M.TCS_QTY * M.WT_QTY)
	                        END,
						SUM(M.TCS_QTY * M.WT_QTY) AS TCS_QTY
					FROM
						F_PIPESUM M
						LEFT JOIN M_NAME NAME_PROC ON M.PROC_TYPE = NAME_PROC.NAME_CODE AND NAME_PROC.NAMECLS_CODE = 'PROC'
						LEFT JOIN M_NAME NAME_AFPR ON M.AFPR_TYPE = NAME_AFPR.NAME_CODE AND NAME_AFPR.NAMECLS_CODE = 'AFPR'
						LEFT JOIN M_NAME NAME_DRAW ON M.DRAW_TYPE = NAME_DRAW.NAME_CODE AND NAME_DRAW.NAMECLS_CODE = 'DRAW'
						LEFT JOIN M_CUST CUST ON M.CUST_CODE = CUST.CUST_CODE
						LEFT JOIN M_NAME TTL ON (CUST.TTL_CODE = TTL.NAME_CODE AND TTL.NAMECLS_CODE = 'TTL')
						LEFT JOIN M_CTL MCTL ON (MCTL.C_KEY = 'PIPE_LEN' AND MCTL.USERID = 'SYSTEM')
	                    LEFT JOIN M_KIND MKIND1 ON (MKIND1.KIND_CODE = '1')
	                    LEFT JOIN M_KIND MKIND2 ON (MKIND2.KIND_CODE = '2')
	                strCondition
					GROUP BY
						M.CUST_CODE,
						CUST.CUST1_NAME,
						TTL.NAME_NAME,
						CUST.WTOUT_TYPE,
						M.SHIP_NO,

						M.DRAW_TYPE,
						NAME_DRAW.NAME_NAME,
						M.AFPR_TYPE,
						NAME_AFPR.NAME_NAME,
						M.SIGN_NO,

						M.BLOCK_NAME,
						M.DRAW_NO,
						M.LCLS_CODE,
						M.MCLS_CODE,
						M.PROC_TYPE,
						NAME_PROC.NAME_RNAME,

						NAME_PROC.DSPORDER_NO,
						M.KIND_CODE
					HAVING M.AFPR_TYPE = 1
			)
			AS B
			GROUP BY
	                B.CUST_CODE,
	                B.CUST1_NAME,
	                B.TTL_NAME,
	                B.BLOCK_NAME_DRAW_NO,
	                B.BLOCK_NAME_DRAW_NO_NAME,

	                B.SHIP_NO,
	                B.DRAW_TYPE,
	                B.DRAW_NAME,
	                B.AFPR_TYPE,
	                B.AFPR_NAME,

	                B.SIGN_NO,
	                B.BLOCK_NAME,
	                B.DRAW_NO,
	                B.LCLS_CODE,
	                B.PROC_TYPE,

	                B.PROC_NAME,
	                B.DSPORDER_NO
			)
		)
	    AS C
	    ORDER BY
	        C.AFPR_TYPE,
	        C.CUST_CODE,
	        C.SHIP_NO,
	        C.DRAW_TYPE,
	        C.SIGN_NO,
	        C.BLOCK_NAME,
	        C.DRAW_NO,
	        C.LCLS_CODE
	</M_REPORT508>

	<M_REPORT515>
		SELECT
            B.CUST_CODE,
            B.CUST1_NAME,
            B.TTL_NAME,
            B.SHIP_NO,
            B.DRAW_TYPE,

            B.DRAW_NAME,
            B.AFPR_TYPE,
            B.AFPR_NAME,
            B.SIGN_NO,
            B.BLOCK_NAME,

            B.DRAW_NO,
            B.BLOCK_NAME_DRAW_NO,
            B.BLOCK_NAME_DRAW_NO_NAME,
            B.LCLS_CODE,
            B.PROC_TYPE,

            B.PROC_NAME,
            B.DSPORDER_NO,
            SUM(B.TLEN_QTY) AS TLEN_QTY,
            SUM(B.TCS_QTY) AS TCS_QTY
        FROM (
                (SELECT
                    M.CUST_CODE,
                    CUST.CUST1_NAME,
                    TTL.NAME_NAME AS TTL_NAME,
                    M.SHIP_NO,
                    M.DRAW_TYPE,
                    NAME_DRAW.NAME_NAME AS DRAW_NAME,
                    M.AFPR_TYPE,
                    NAME_AFPR.NAME_NAME AS AFPR_NAME,
                    M.SIGN_NO,
                    M.BLOCK_NAME,
                    M.DRAW_NO,
                    CASE
                        WHEN CUST.WTOUT_TYPE = '0' THEN M.BLOCK_NAME
                        WHEN CUST.WTOUT_TYPE = '1' THEN M.DRAW_NO
                        ELSE ''
                    END AS BLOCK_NAME_DRAW_NO,
                    CASE
                        WHEN CUST.WTOUT_TYPE = '0' THEN 'ブロック名'
                        WHEN CUST.WTOUT_TYPE = '1' THEN '図番'
                        ELSE ''
                    END AS BLOCK_NAME_DRAW_NO_NAME,
                    M.LCLS_CODE,
                    M.PROC_TYPE,
                    NAME_PROC.NAME_RNAME AS PROC_NAME,
                    NAME_PROC.DSPORDER_NO,
                    TLEN_QTY = CASE
                            WHEN (M.LCLS_CODE = '0' AND M.KIND_CODE = '') THEN SUM(M.TLEN_QTY / (COALESCE(convert(int, MCTL.C_DATA), 5510) ) * M.WT_QTY)
                            WHEN (M.LCLS_CODE = '0' AND M.KIND_CODE = '1') THEN SUM(M.TLEN_QTY / (COALESCE(convert(int, MKIND1.LENTO_QRY ), 4005) ) * M.WT_QTY)
                            WHEN (M.LCLS_CODE = '0' AND M.KIND_CODE = '2') THEN SUM(M.TLEN_QTY / (COALESCE(convert(int, MKIND2.LENTO_QRY ), 6006) ) * M.WT_QTY)
                            WHEN (M.LCLS_CODE = '1' AND M.MCLS_CODE = '14') THEN SUM(M.TLEN_QTY / (COALESCE(convert(int, MCTL.C_DATA), 5510) ) * M.WT_QTY )
                            WHEN (M.LCLS_CODE = '1' AND M.MCLS_CODE = '15') THEN SUM(M.TLEN_QTY / (COALESCE(convert(int, MCTL.C_DATA), 5510) ) * M.WT_QTY )
                            WHEN (M.LCLS_CODE = '1' AND M.MCLS_CODE = '18') THEN SUM(M.TLEN_QTY / (COALESCE(convert(int, MCTL.C_DATA), 5510) ) * M.WT_QTY )
                            ELSE SUM(M.TCS_QTY * M.WT_QTY)
                        END,
                    SUM(M.TCS_QTY * M.WT_QTY) AS TCS_QTY
                FROM
                    F_PIPESUM M
                    LEFT JOIN M_NAME NAME_PROC ON M.PROC_TYPE = NAME_PROC.NAME_CODE AND NAME_PROC.NAMECLS_CODE = 'PROC'
                    LEFT JOIN M_NAME NAME_AFPR ON M.AFPR_TYPE = NAME_AFPR.NAME_CODE AND NAME_AFPR.NAMECLS_CODE = 'AFPR'
                    LEFT JOIN M_NAME NAME_DRAW ON M.DRAW_TYPE = NAME_DRAW.NAME_CODE AND NAME_DRAW.NAMECLS_CODE = 'DRAW'
                    LEFT JOIN M_CUST CUST ON M.CUST_CODE = CUST.CUST_CODE
                    LEFT JOIN M_NAME TTL ON (CUST.TTL_CODE = TTL.NAME_CODE AND TTL.NAMECLS_CODE = 'TTL')
                    LEFT JOIN M_CTL MCTL ON (MCTL.C_KEY = 'PIPE_LEN' AND MCTL.USERID = 'SYSTEM')
                    LEFT JOIN M_KIND MKIND1 ON (MKIND1.KIND_CODE = '1')
                    LEFT JOIN M_KIND MKIND2 ON (MKIND2.KIND_CODE = '2')
                strCondition
                GROUP BY
                    M.CUST_CODE,
                    CUST.CUST1_NAME,
                    TTL.NAME_NAME,
                    CUST.WTOUT_TYPE,
                    M.SHIP_NO,

                    M.DRAW_TYPE,
                    NAME_DRAW.NAME_NAME,
                    M.AFPR_TYPE,
                    NAME_AFPR.NAME_NAME,
                    M.SIGN_NO,

                    M.BLOCK_NAME,
                    M.DRAW_NO,
                    M.LCLS_CODE,
                    M.MCLS_CODE,
                    M.PROC_TYPE,
                    NAME_PROC.NAME_RNAME,

                    NAME_PROC.DSPORDER_NO,
                    M.KIND_CODE
                HAVING M.AFPR_TYPE = 1
                )
        ) AS B
            GROUP BY
                B.CUST_CODE,
                B.CUST1_NAME,
                B.TTL_NAME,
                B.BLOCK_NAME_DRAW_NO,
                B.BLOCK_NAME_DRAW_NO_NAME,

                B.SHIP_NO,
                B.DRAW_TYPE,
                B.DRAW_NAME,
                B.AFPR_TYPE,
                B.AFPR_NAME,

                B.SIGN_NO,
                B.BLOCK_NAME,
                B.DRAW_NO,
                B.LCLS_CODE,
                B.PROC_TYPE,

                B.PROC_NAME,
                B.DSPORDER_NO
            ORDER BY
                B.AFPR_TYPE,
                B.CUST_CODE,
                B.SHIP_NO,
                B.DRAW_TYPE,
                B.SIGN_NO,
                B.BLOCK_NAME,
                B.DRAW_NO,
                B.LCLS_CODE
	</M_REPORT515>


	<M_REPORT5081>
	SELECT DISTINCT
	    M.LCLS_CODE,
	    LCLS.LCLS_NAME,
	    M.MCLS_CODE,
	    MCLS.MCLS_NAME,
	    M.SCLS_CODE,
	    M.TYPE_CODE,
	    TP.TYPE_NAME,
	    M.MATER_CODE,
	    MA.MATER_TNAME AS MATER_NAME,
	    M.PDMETER,
	    M.STD_CODE,
	    COALESCE(STD.STD_NAME,'') + ' ' +COALESCE(MK.KIND_NAME,'')AS STD_NAME,
	    M.SIZE_NAME
	FROM
	   F_PIPESUM M
        LEFT JOIN M_LCLS LCLS ON M.LCLS_CODE = LCLS.LCLS_CODE
	    LEFT JOIN M_MCLS MCLS ON M.LCLS_CODE = MCLS.LCLS_CODE AND M.MCLS_CODE = MCLS.MCLS_CODE
	    LEFT JOIN M_PROD P
	        ON M.LCLS_CODE = P.LCLS_CODE
	        AND M.MCLS_CODE = P.MCLS_CODE
	        AND M.TYPE_CODE = P.TYPE_CODE
	        AND M.MATER_CODE = P.MATER_CODE
	        AND M.PDMETER = P.PDMETER
	        AND M.STD_CODE = P.STD_CODE
	        AND P.CUST_CODE = CASE
						WHEN (MCLS.SPCL_TYPE = '1' OR MCLS.SPCL_TYPE = '3' ) THEN M.CUST_CODE
						ELSE ''
					  END
              AND M.KIND_CODE = CASE
						WHEN (MCLS.SUS_TYPE= '1') THEN P.KIND_CODE
						ELSE ''
					  END
              AND P.FREQTY = 0
	    LEFT JOIN M_TYPE TP ON M.TYPE_CODE = TP.TYPE_CODE
	    LEFT JOIN M_MATER MA ON M.MATER_CODE = MA.MATER_CODE
	    LEFT JOIN M_STD STD ON M.STD_CODE = STD.STD_CODE
	    LEFT JOIN M_KIND AS MK ON MK.KIND_CODE =  M.KIND_CODE
	 </M_REPORT5081>

	<M_REPORT507>
		(SELECT
			H.SHIP_NO,
			H.DRAW_NO,
			DRAW.NAME_NAME AS DRAW_NAME,
			D.PROC_TYPE,
			MPROC.NAME_NAME AS PROC_NAME,
			MPROC.DSPORDER_NO,
			H.BLOCK_NAME,
			H.SIGN_NO,
			S.MATER_CODE,
			MATER.MATER_NAME,
			MATER.DSPORDER_NO,
			S.STD_CODE,
			RTRIM(LTRIM(COALESCE(MSTD.STD_NAME,'') + ' ' +  COALESCE(MK.KIND_NAME,''))) AS STD_NAME,
			MSTD.DSPORDER_NO,
			S.PDMETER,
			PDMET.NAME_NAME AS PDMETER_NAME,
			PDMET.DSPORDER_NO,
			RTRIM(MCLS.MCLS_NAME) + ' ' + COALESCE(MTE.TYPE_NAME,'') AS MCLS_NAME,
			SUM(D.CS_QTY) AS CS_QTY,
			NULL AS LEN_QTY,
			SUM(D.CS_QTY * S.AMT_QTY) AS AMT_QTY,
			'1' AS TYPE,
			S.LCLS_CODE,
			S.MCLS_CODE,
			MCLS.SUS_TYPE,
			MAX(PROD.WT_QTY) AS WT_QTY
		FROM
			TR_PIPES S
			JOIN TR_PIPED D ON S.MN_NO = D.MN_NO AND S.MN_DATE = D.MN_DATE AND S.PAGE_NO = D.PAGE_NO AND S.TANDB_TYPE = D.TANDB_TYPE
			JOIN TR_PIPEH H ON D.MN_NO = H.MN_NO AND D.MN_DATE = H.MN_DATE
			LEFT JOIN M_MCLS MCLS ON S.LCLS_CODE = MCLS.LCLS_CODE AND S.MCLS_CODE = MCLS.MCLS_CODE
		    LEFT JOIN M_KIND AS MK ON MK.KIND_CODE  = CASE WHEN (S.LCLS_CODE != 0) THEN ''
							WHEN (S.LCLS_CODE = 0 AND MCLS.SUS_TYPE = 0) THEN ''
							WHEN (S.LCLS_CODE = 0 AND MCLS.SUS_TYPE = 1 AND S.LEN_QTY > (SELECT K.LENTO_QRY FROM M_KIND K WHERE K.KIND_CODE = 1)) THEN '2'
							ELSE '1'
					   END			
			LEFT JOIN M_NAME DRAW ON ( H.DRAW_NO = DRAW.NAME_CODE AND DRAW.NAMECLS_CODE = 'DRAW' )
			LEFT JOIN M_NAME MPROC ON ( D.PROC_TYPE = MPROC.NAME_CODE AND MPROC.NAMECLS_CODE = 'PROC' )
			LEFT JOIN M_NAME PDMET ON ( S.PDMETER = PDMET.NAME_CODE AND PDMET.NAMECLS_CODE = 'PDMETER' )
			LEFT JOIN M_MATER MATER ON S.MATER_CODE = MATER.MATER_CODE
			LEFT JOIN M_STD MSTD ON S.STD_CODE = MSTD.STD_CODE
			LEFT JOIN M_TYPE AS MTE ON MTE.TYPE_CODE =  S.TYPE_CODE
			LEFT JOIN (SELECT
							LCLS_CODE,
							MCLS_CODE,
							SCLS_CODE,
							TYPE_CODE,
							MATER_CODE,
							PDMETER,
							STD_CODE,
							CUST_CODE,
							KIND_CODE,
							FREQTY,
							WT_QTY
						FROM
							M_PROD PROD
						GROUP BY 
							LCLS_CODE,
							MCLS_CODE,
							SCLS_CODE,
							TYPE_CODE,
							MATER_CODE,
							PDMETER,
							STD_CODE,
							CUST_CODE,
							KIND_CODE,
							FREQTY,
							WT_QTY) AS PROD
						ON S.LCLS_CODE = PROD.LCLS_CODE
							AND S.MCLS_CODE = PROD.MCLS_CODE
							AND S.TYPE_CODE = PROD.TYPE_CODE
							AND S.MATER_CODE = PROD.MATER_CODE
							AND S.PDMETER = PROD.PDMETER
							AND S.STD_CODE = PROD.STD_CODE
							AND RTRIM(PROD.CUST_CODE) = CASE
										WHEN (RTRIM(MCLS.SPCL_TYPE) = '1' OR RTRIM(MCLS.SPCL_TYPE) = '3' ) THEN RTRIM(H.CUST_CODE)
										ELSE ''
									  END
							AND PROD.KIND_CODE = ''
							AND PROD.FREQTY = 0
		strCondition1
		GROUP BY
			H.SHIP_NO,
			H.DRAW_NO,
			DRAW.NAME_NAME,
			D.PROC_TYPE,
			MPROC.NAME_NAME,
			MPROC.DSPORDER_NO,
			H.BLOCK_NAME,
			H.SIGN_NO,
			S.MATER_CODE,
			MATER.MATER_NAME,
			MATER.DSPORDER_NO,
			S.STD_CODE,
			MSTD.STD_NAME,
			MK.KIND_NAME,
			MSTD.DSPORDER_NO,
			S.PDMETER,
			PDMET.NAME_NAME,
			PDMET.DSPORDER_NO,
			S.LCLS_CODE,
			S.MCLS_CODE,
			MCLS.SUS_TYPE,
			RTRIM(MCLS.MCLS_NAME),
			MTE.TYPE_NAME
			)
		UNION ALL
		(SELECT
			H.SHIP_NO,
			H.DRAW_NO,
			DRAW.NAME_NAME AS DRAW_NAME,
			D.PROC_TYPE,
			MPROC.NAME_NAME AS PROC_NAME,
			MPROC.DSPORDER_NO,
			H.BLOCK_NAME,
			H.SIGN_NO,
			S.MATER_CODE,
			MATER.MATER_NAME,
			MATER.DSPORDER_NO,
			S.STD_CODE,
			RTRIM(LTRIM(COALESCE(MSTD.STD_NAME,'') + ' ' +  COALESCE(MK.KIND_NAME,''))) AS STD_NAME,
			MSTD.DSPORDER_NO,
			S.PDMETER,
			PDMET.NAME_NAME AS PDMETER_NAME,
			PDMET.DSPORDER_NO,
			RTRIM(MCLS.MCLS_NAME) + ' ' + COALESCE(MTE.TYPE_NAME,'') AS MCLS_NAME,
			SUM(D.CS_QTY) AS CS_QTY,
			SUM(D.CS_QTY * S.LEN_QTY) AS LEN_QTY,
			SUM(D.CS_QTY * S.AMT_QTY) AS AMT_QTY,
			'2' AS TYPE,
			S.LCLS_CODE,
			S.MCLS_CODE,
			MCLS.SUS_TYPE,
			MAX(PROD.WT_QTY) AS WT_QTY
		FROM
			TR_PIPES S
			JOIN TR_PIPED D ON S.MN_NO = D.MN_NO AND S.MN_DATE = D.MN_DATE AND S.PAGE_NO = D.PAGE_NO AND S.TANDB_TYPE = D.TANDB_TYPE
			JOIN TR_PIPEH H ON D.MN_NO = H.MN_NO AND D.MN_DATE = H.MN_DATE
			LEFT JOIN M_MCLS MCLS ON S.LCLS_CODE = MCLS.LCLS_CODE AND S.MCLS_CODE = MCLS.MCLS_CODE
		    LEFT JOIN M_KIND AS MK ON MK.KIND_CODE  = CASE WHEN (S.LCLS_CODE != 0) THEN ''
							WHEN (S.LCLS_CODE = 0 AND MCLS.SUS_TYPE = 0) THEN ''
							WHEN (S.LCLS_CODE = 0 AND MCLS.SUS_TYPE = 1 AND S.LEN_QTY > (SELECT K.LENTO_QRY FROM M_KIND K WHERE K.KIND_CODE = 1)) THEN '2'
							ELSE '1'
					   END			
			LEFT JOIN M_NAME DRAW ON ( H.DRAW_NO = DRAW.NAME_CODE AND DRAW.NAMECLS_CODE = 'DRAW' )
			LEFT JOIN M_NAME MPROC ON ( D.PROC_TYPE = MPROC.NAME_CODE AND MPROC.NAMECLS_CODE = 'PROC' )
			LEFT JOIN M_NAME PDMET ON ( S.PDMETER = PDMET.NAME_CODE AND PDMET.NAMECLS_CODE = 'PDMETER' )
			LEFT JOIN M_MATER MATER ON S.MATER_CODE = MATER.MATER_CODE
			LEFT JOIN M_STD MSTD ON S.STD_CODE = MSTD.STD_CODE
			LEFT JOIN M_TYPE AS MTE ON MTE.TYPE_CODE =  S.TYPE_CODE
			LEFT JOIN (SELECT
							LCLS_CODE,
							MCLS_CODE,
							SCLS_CODE,
							TYPE_CODE,
							MATER_CODE,
							PDMETER,
							STD_CODE,
							CUST_CODE,
							KIND_CODE,
							FREQTY,
							WT_QTY
						FROM
							M_PROD PROD
						GROUP BY 
							LCLS_CODE,
							MCLS_CODE,
							SCLS_CODE,
							TYPE_CODE,
							MATER_CODE,
							PDMETER,
							STD_CODE,
							CUST_CODE,
							KIND_CODE,
							FREQTY,
							WT_QTY) AS PROD
						ON S.LCLS_CODE = PROD.LCLS_CODE
							AND S.MCLS_CODE = PROD.MCLS_CODE
							AND S.TYPE_CODE = PROD.TYPE_CODE
							AND S.MATER_CODE = PROD.MATER_CODE
							AND S.PDMETER = PROD.PDMETER
							AND S.STD_CODE = PROD.STD_CODE
							AND RTRIM(PROD.CUST_CODE) = CASE
										WHEN (RTRIM(MCLS.SPCL_TYPE) = '1' OR RTRIM(MCLS.SPCL_TYPE) = '3' ) THEN RTRIM(H.CUST_CODE)
										ELSE ''
									  END
							AND PROD.KIND_CODE = ''
							AND PROD.FREQTY = 0
		strCondition2
		GROUP BY
			H.SHIP_NO,
			H.DRAW_NO,
			DRAW.NAME_NAME,
			D.PROC_TYPE,
			MPROC.NAME_NAME,
			MPROC.DSPORDER_NO,
			H.BLOCK_NAME,
			H.SIGN_NO,
			S.MATER_CODE,
			MATER.MATER_NAME,
			MATER.DSPORDER_NO,
			S.STD_CODE,
			MSTD.STD_NAME,
			MK.KIND_NAME,			
			MSTD.DSPORDER_NO,
			S.PDMETER,
			PDMET.NAME_NAME,
			PDMET.DSPORDER_NO,
			S.LCLS_CODE,
			S.MCLS_CODE,
			MCLS.SUS_TYPE,
			RTRIM(MCLS.MCLS_NAME),
			MTE.TYPE_NAME
			)
		UNION ALL
		(SELECT
			H.SHIP_NO,
			H.DRAW_NO,
			DRAW.NAME_NAME AS DRAW_NAME,
			D.PROC_TYPE,
			MPROC.NAME_NAME AS PROC_NAME,
			MPROC.DSPORDER_NO,
			H.BLOCK_NAME,
			H.SIGN_NO,
			S.MATER_CODE,
			MATER.MATER_NAME,
			MATER.DSPORDER_NO,
			S.STD_CODE,
			RTRIM(LTRIM(COALESCE(MSTD.STD_NAME,'') + ' ' +  COALESCE(MK.KIND_NAME,''))) AS STD_NAME,
			MSTD.DSPORDER_NO,
			S.PDMETER,
			PDMET.NAME_NAME AS PDMETER_NAME,
			PDMET.DSPORDER_NO,
			RTRIM(MCLS.MCLS_NAME) + ' ' + COALESCE(MTE.TYPE_NAME,'') AS MCLS_NAME,
			SUM(D.CS_QTY) AS CS_QTY,
			SUM(D.CS_QTY * S.LEN_QTY) AS LEN_QTY,
			SUM(D.CS_QTY * S.AMT_QTY) AS AMT_QTY,
			'3' AS TYPE,
			S.LCLS_CODE,
			S.MCLS_CODE,
			MCLS.SUS_TYPE,
			MAX(PROD.WT_QTY) AS WT_QTY
		FROM
			TR_PIPES S
			JOIN TR_PIPED D ON S.MN_NO = D.MN_NO AND S.MN_DATE = D.MN_DATE AND S.PAGE_NO = D.PAGE_NO AND S.TANDB_TYPE = D.TANDB_TYPE
			JOIN TR_PIPEH H ON D.MN_NO = H.MN_NO AND D.MN_DATE = H.MN_DATE
			LEFT JOIN M_MCLS MCLS ON S.LCLS_CODE = MCLS.LCLS_CODE AND S.MCLS_CODE = MCLS.MCLS_CODE
		    LEFT JOIN M_KIND AS MK ON MK.KIND_CODE  = CASE WHEN (S.LCLS_CODE != 0) THEN ''
							WHEN (S.LCLS_CODE = 0 AND MCLS.SUS_TYPE = 0) THEN ''
							WHEN (S.LCLS_CODE = 0 AND MCLS.SUS_TYPE = 1 AND S.LEN_QTY > (SELECT K.LENTO_QRY FROM M_KIND K WHERE K.KIND_CODE = 1)) THEN '2'
							ELSE '1'
					   END			
			LEFT JOIN M_NAME DRAW ON ( H.DRAW_NO = DRAW.NAME_CODE AND DRAW.NAMECLS_CODE = 'DRAW' )
			LEFT JOIN M_NAME MPROC ON ( D.PROC_TYPE = MPROC.NAME_CODE AND MPROC.NAMECLS_CODE = 'PROC' )
			LEFT JOIN M_NAME PDMET ON ( S.PDMETER = PDMET.NAME_CODE AND PDMET.NAMECLS_CODE = 'PDMETER' )
			LEFT JOIN M_MATER MATER ON S.MATER_CODE = MATER.MATER_CODE
			LEFT JOIN M_STD MSTD ON S.STD_CODE = MSTD.STD_CODE
			LEFT JOIN M_TYPE AS MTE ON MTE.TYPE_CODE = S.TYPE_CODE
			LEFT JOIN (SELECT
							LCLS_CODE,
							MCLS_CODE,
							SCLS_CODE,
							TYPE_CODE,
							MATER_CODE,
							PDMETER,
							STD_CODE,
							CUST_CODE,
							KIND_CODE,
							FREQTY,
							WT_QTY
						FROM
							M_PROD PROD
						GROUP BY 
							LCLS_CODE,
							MCLS_CODE,
							SCLS_CODE,
							TYPE_CODE,
							MATER_CODE,
							PDMETER,
							STD_CODE,
							CUST_CODE,
							KIND_CODE,
							FREQTY,
							WT_QTY) AS PROD
						ON S.LCLS_CODE = PROD.LCLS_CODE
							AND S.MCLS_CODE = PROD.MCLS_CODE
							AND S.TYPE_CODE = PROD.TYPE_CODE
							AND S.MATER_CODE = PROD.MATER_CODE
							AND S.PDMETER = PROD.PDMETER
							AND S.STD_CODE = PROD.STD_CODE
							AND RTRIM(PROD.CUST_CODE) = CASE
										WHEN (RTRIM(MCLS.SPCL_TYPE) = '1' OR RTRIM(MCLS.SPCL_TYPE) = '3' ) THEN RTRIM(H.CUST_CODE)
										ELSE ''
									  END
							AND PROD.KIND_CODE = '1'
							AND PROD.FREQTY = 0
		strCondition3
		GROUP BY
			H.SHIP_NO,
			H.DRAW_NO,
			DRAW.NAME_NAME,
			D.PROC_TYPE,
			MPROC.NAME_NAME,
			MPROC.DSPORDER_NO,
			H.BLOCK_NAME,
			H.SIGN_NO,
			S.MATER_CODE,
			MATER.MATER_NAME,
			MATER.DSPORDER_NO,
			S.STD_CODE,
			MSTD.STD_NAME,
			MK.KIND_NAME,
			MSTD.DSPORDER_NO,
			S.PDMETER,
			PDMET.NAME_NAME,
			PDMET.DSPORDER_NO,
			S.LCLS_CODE,
			S.MCLS_CODE,
			MCLS.SUS_TYPE,
			RTRIM(MCLS.MCLS_NAME),
			MTE.TYPE_NAME
			)
		UNION ALL
		(SELECT
			H.SHIP_NO,
			H.DRAW_NO,
			DRAW.NAME_NAME AS DRAW_NAME,
			D.PROC_TYPE,
			MPROC.NAME_NAME AS PROC_NAME,
			MPROC.DSPORDER_NO,
			H.BLOCK_NAME,
			H.SIGN_NO,
			S.MATER_CODE,
			MATER.MATER_NAME,
			MATER.DSPORDER_NO,
			S.STD_CODE,
			RTRIM(LTRIM(COALESCE(MSTD.STD_NAME,'') + ' ' +  COALESCE(MK.KIND_NAME,''))) AS STD_NAME,
			MSTD.DSPORDER_NO,
			S.PDMETER,
			PDMET.NAME_NAME AS PDMETER_NAME,
			PDMET.DSPORDER_NO,
			RTRIM(MCLS.MCLS_NAME) + ' ' + COALESCE(MTE.TYPE_NAME,'') AS MCLS_NAME,
			SUM(D.CS_QTY) AS CS_QTY,
			SUM(D.CS_QTY * S.LEN_QTY) AS LEN_QTY,
			SUM(D.CS_QTY * S.AMT_QTY) AS AMT_QTY,
			'4' AS TYPE,
			S.LCLS_CODE,
			S.MCLS_CODE,
			MCLS.SUS_TYPE,
			MAX(PROD.WT_QTY) AS WT_QTY
		FROM
			TR_PIPES S
			JOIN TR_PIPED D ON S.MN_NO = D.MN_NO AND S.MN_DATE = D.MN_DATE AND S.PAGE_NO = D.PAGE_NO AND S.TANDB_TYPE = D.TANDB_TYPE
			JOIN TR_PIPEH H ON D.MN_NO = H.MN_NO AND D.MN_DATE = H.MN_DATE
			LEFT JOIN M_MCLS MCLS ON S.LCLS_CODE = MCLS.LCLS_CODE AND S.MCLS_CODE = MCLS.MCLS_CODE
		    LEFT JOIN M_KIND AS MK ON MK.KIND_CODE  = CASE WHEN (S.LCLS_CODE != 0) THEN ''
							WHEN (S.LCLS_CODE = 0 AND MCLS.SUS_TYPE = 0) THEN ''
							WHEN (S.LCLS_CODE = 0 AND MCLS.SUS_TYPE = 1 AND S.LEN_QTY > (SELECT K.LENTO_QRY FROM M_KIND K WHERE K.KIND_CODE = 1)) THEN '2'
							ELSE '1'
					   END			
			LEFT JOIN M_NAME DRAW ON ( H.DRAW_NO = DRAW.NAME_CODE AND DRAW.NAMECLS_CODE = 'DRAW' )
			LEFT JOIN M_NAME MPROC ON ( D.PROC_TYPE = MPROC.NAME_CODE AND MPROC.NAMECLS_CODE = 'PROC' )
			LEFT JOIN M_NAME PDMET ON ( S.PDMETER = PDMET.NAME_CODE AND PDMET.NAMECLS_CODE = 'PDMETER' )
			LEFT JOIN M_MATER MATER ON S.MATER_CODE = MATER.MATER_CODE
			LEFT JOIN M_STD MSTD ON S.STD_CODE = MSTD.STD_CODE
			LEFT JOIN M_TYPE AS MTE ON MTE.TYPE_CODE =  S.TYPE_CODE
			LEFT JOIN (SELECT
							LCLS_CODE,
							MCLS_CODE,
							SCLS_CODE,
							TYPE_CODE,
							MATER_CODE,
							PDMETER,
							STD_CODE,
							CUST_CODE,
							KIND_CODE,
							FREQTY,
							WT_QTY
						FROM
							M_PROD PROD
						GROUP BY 
							LCLS_CODE,
							MCLS_CODE,
							SCLS_CODE,
							TYPE_CODE,
							MATER_CODE,
							PDMETER,
							STD_CODE,
							CUST_CODE,
							KIND_CODE,
							FREQTY,
							WT_QTY) AS PROD
						ON S.LCLS_CODE = PROD.LCLS_CODE
							AND S.MCLS_CODE = PROD.MCLS_CODE
							AND S.TYPE_CODE = PROD.TYPE_CODE
							AND S.MATER_CODE = PROD.MATER_CODE
							AND S.PDMETER = PROD.PDMETER
							AND S.STD_CODE = PROD.STD_CODE
							AND RTRIM(PROD.CUST_CODE) = CASE
										WHEN (RTRIM(MCLS.SPCL_TYPE) = '1' OR RTRIM(MCLS.SPCL_TYPE) = '3' ) THEN RTRIM(H.CUST_CODE)
										ELSE ''
									  END
							AND PROD.KIND_CODE = '2'
							AND PROD.FREQTY = 0
		strCondition4
		GROUP BY
			H.SHIP_NO,
			H.DRAW_NO,
			DRAW.NAME_NAME,
			D.PROC_TYPE,
			MPROC.NAME_NAME,
			MPROC.DSPORDER_NO,
			H.BLOCK_NAME,
			H.SIGN_NO,
			S.MATER_CODE,
			MATER.MATER_NAME,
			MATER.DSPORDER_NO,
			S.STD_CODE,
			MSTD.STD_NAME,
			MK.KIND_NAME,			
			MSTD.DSPORDER_NO,
			S.PDMETER,
			PDMET.NAME_NAME,
			PDMET.DSPORDER_NO,
			S.LCLS_CODE,
			S.MCLS_CODE,
			MCLS.SUS_TYPE,
			RTRIM(MCLS.MCLS_NAME),
			MTE.TYPE_NAME
			)
		UNION ALL --truong hop tugite dac biet 14,15,18
		(SELECT
			H.SHIP_NO,
			H.DRAW_NO,
			DRAW.NAME_NAME AS DRAW_NAME,
			D.PROC_TYPE,
			MPROC.NAME_NAME AS PROC_NAME,
			MPROC.DSPORDER_NO,
			H.BLOCK_NAME,
			H.SIGN_NO,
			S.MATER_CODE,
			MATER.MATER_NAME,
			MATER.DSPORDER_NO,
			RTRIM(LTRIM(COALESCE(MSTD.STD_NAME,'') + ' ' +  COALESCE(MK.KIND_NAME,''))) AS STD_NAME,
			MSTD.STD_NAME,
			MSTD.DSPORDER_NO,
			S.PDMETER,
			PDMET.NAME_NAME AS PDMETER_NAME,
			PDMET.DSPORDER_NO,
			RTRIM(MCLS.MCLS_NAME) + ' ' + COALESCE(MTE.TYPE_NAME,'') AS MCLS_NAME,
			SUM(D.CS_QTY) AS CS_QTY,
			SUM(D.CS_QTY * S.LEN_QTY) AS LEN_QTY,
			0 AS AMT_QTY,
			'2' AS TYPE,
			S.LCLS_CODE,
			S.MCLS_CODE,
			MCLS.SUS_TYPE,
			MAX(PROD.WT_QTY) AS WT_QTY
		FROM
			TR_PIPES S
			JOIN TR_PIPED D ON S.MN_NO = D.MN_NO AND S.MN_DATE = D.MN_DATE AND S.PAGE_NO = D.PAGE_NO AND S.TANDB_TYPE = D.TANDB_TYPE
			JOIN TR_PIPEH H ON D.MN_NO = H.MN_NO AND D.MN_DATE = H.MN_DATE
			LEFT JOIN M_MCLS MCLS ON S.LCLS_CODE = MCLS.LCLS_CODE AND S.MCLS_CODE = MCLS.MCLS_CODE
		    LEFT JOIN M_KIND AS MK ON MK.KIND_CODE  = CASE WHEN (S.LCLS_CODE != 0) THEN ''
							WHEN (S.LCLS_CODE = 0 AND MCLS.SUS_TYPE = 0) THEN ''
							WHEN (S.LCLS_CODE = 0 AND MCLS.SUS_TYPE = 1 AND S.LEN_QTY > (SELECT K.LENTO_QRY FROM M_KIND K WHERE K.KIND_CODE = 1)) THEN '2'
							ELSE '1'
					   END			
			LEFT JOIN M_NAME DRAW ON ( H.DRAW_NO = DRAW.NAME_CODE AND DRAW.NAMECLS_CODE = 'DRAW' )
			LEFT JOIN M_NAME MPROC ON ( D.PROC_TYPE = MPROC.NAME_CODE AND MPROC.NAMECLS_CODE = 'PROC' )
			LEFT JOIN M_NAME PDMET ON ( S.PDMETER = PDMET.NAME_CODE AND PDMET.NAMECLS_CODE = 'PDMETER' )
			LEFT JOIN M_MATER MATER ON S.MATER_CODE = MATER.MATER_CODE
			LEFT JOIN M_STD MSTD ON S.STD_CODE = MSTD.STD_CODE
			LEFT JOIN M_TYPE AS MTE ON MTE.TYPE_CODE =  S.TYPE_CODE
			LEFT JOIN (SELECT
							LCLS_CODE,
							MCLS_CODE,
							SCLS_CODE,
							TYPE_CODE,
							MATER_CODE,
							PDMETER,
							STD_CODE,
							CUST_CODE,
							KIND_CODE,
							FREQTY,
							WT_QTY
						FROM
							M_PROD PROD
						GROUP BY 
							LCLS_CODE,
							MCLS_CODE,
							SCLS_CODE,
							TYPE_CODE,
							MATER_CODE,
							PDMETER,
							STD_CODE,
							CUST_CODE,
							KIND_CODE,
							FREQTY,
							WT_QTY) AS PROD
						ON S.LCLS_CODE = PROD.LCLS_CODE
							AND S.MCLS_CODE = PROD.MCLS_CODE
							AND S.TYPE_CODE = PROD.TYPE_CODE
							AND S.MATER_CODE = PROD.MATER_CODE
							AND S.PDMETER = PROD.PDMETER
							AND S.STD_CODE = PROD.STD_CODE
							AND RTRIM(PROD.CUST_CODE) = CASE
										WHEN (RTRIM(MCLS.SPCL_TYPE) = '1' OR RTRIM(MCLS.SPCL_TYPE) = '3' ) THEN RTRIM(H.CUST_CODE)
										ELSE ''
									  END
							AND PROD.KIND_CODE = ''
							AND PROD.FREQTY = 0
		strCondition5
		GROUP BY
			H.SHIP_NO,
			H.DRAW_NO,
			DRAW.NAME_NAME,
			D.PROC_TYPE,
			MPROC.NAME_NAME,
			MPROC.DSPORDER_NO,
			H.BLOCK_NAME,
			H.SIGN_NO,
			S.MATER_CODE,
			MATER.MATER_NAME,
			MATER.DSPORDER_NO,
			S.STD_CODE,
			MSTD.STD_NAME,
			MK.KIND_NAME,			
			MSTD.DSPORDER_NO,
			S.PDMETER,
			PDMET.NAME_NAME,
			PDMET.DSPORDER_NO,
			S.LCLS_CODE,
			S.MCLS_CODE,
			MCLS.SUS_TYPE,
			RTRIM(MCLS.MCLS_NAME),
			MTE.TYPE_NAME
		)
		ORDER BY
			H.BLOCK_NAME,
			MPROC.DSPORDER_NO,
			S.LCLS_CODE,
			S.MCLS_CODE,
			MATER.DSPORDER_NO,
			MSTD.DSPORDER_NO,
			PDMET.DSPORDER_NO
	</M_REPORT507>

	<M_REPORT5071>
		SELECT
			SUM(CS_QTY) AS CS_QTY
		FROM
			TR_PIPED D
			JOIN TR_PIPEH H ON H.MN_NO = D.MN_NO AND H.MN_DATE = D.MN_DATE
		WHERE
			H.CUST_CODE = ?
			AND H.SHIP_NO = ?
			AND H.DRAW_NO = ?
			AND H.BLOCK_NAME = ?
			AND D.PROC_TYPE = ?
	</M_REPORT5071>
	<M_REPORT505>
		SELECT
            M.BLOCK_NAME AS 'BLOCK_NAME'
            ,SUM (CS_QTY *(CASE
                            WHEN D.PROC_TYPE != '6' AND D.PROC_TYPE != '7' THEN 1
                            ELSE 0
                         END)) AS 'IPPAN'
            ,SUM (CS_QTY *(CASE
                            WHEN D.PROC_TYPE = '6' OR D.PROC_TYPE = '7' THEN 1
                            ELSE 0
                         END)) AS 'SUS'
            ,MAX(SIGN_NO) AS SIGN_NO
     FROM
            TR_PIPEH M
            LEFT JOIN TR_PIPED D
                        ON M.MN_NO = D.MN_NO
                        AND M.MN_DATE = D.MN_DATE
	</M_REPORT505>

	<M_REPORT017>
		SELECT DISTINCT
		    COALESCE(TBHK.CUST_CODE, TBPL.CUST_CODE, TBGN.CUST_CODE) AS CUST_CODE
		    ,COALESCE(TBHK.CUST1_NAME, TBPL.CUST1_NAME, TBGN.CUST1_NAME) AS CUST1_NAME
		    ,COALESCE(TBHK.TTL_NAME, TBPL.TTL_NAME, TBGN.TTL_NAME) AS TTL_NAME
		    ,COALESCE(TBHK.METER_NAME, TBPL.METER_NAME, TBGN.METER_NAME) AS METER_NAME
		    ,COALESCE(TBHK.SHIP_NO, TBPL.SHIP_NO, TBGN.SHIP_NO) AS SHIP_BLOCK
		    ,SUM(TBHK.CS_QTY) AS $SUM1
		    ,SUM(TBPL.CS_QTY) AS $SUM2
		    ,SUM(TBGN.CS_QTY) AS $SUM3
		FROM
		(
		    SELECT
		        COALESCE(M1.CUST_CODE,'') AS CUST_CODE
		        ,COALESCE(MT.CUST1_NAME,'') AS CUST1_NAME
		        ,COALESCE(MTTL.NAME_NAME,'') AS TTL_NAME
		        ,COALESCE(M1.PDMETER,0) AS METER_NAME
		        ,COALESCE(M1.SHIP_NO,'') AS SHIP_NO
		        ,M1.CS_QTY AS CS_QTY
		        ,MM.PCLSNM_CODE AS PCLSNM_CODE
		        ,MT.TTL_CODE
		    FROM
		        (
		            SELECT
		                CUST_CODE,
		                SHIP_NO,
		                PROC_TYPE,
		                PDMETER,
		                SUM(CS_QTY) AS CS_QTY
		            FROM
		                (SELECT
		                    H.CUST_CODE,
		                    H.SHIP_NO,
		                    D.PAGE_NO,
		                    D.TANDB_TYPE,
		                    D.PROC_TYPE,
		                    D.CS_QTY,
		                    MAX(CAST(REPLACE(S.PDMETER, 'A', '') AS Numeric(4, 0))) AS PDMETER
		                FROM
		                    TR_PIPED AS D LEFT OUTER JOIN
		                    TR_PIPEH AS H ON D.MN_NO = H.MN_NO AND D.MN_DATE = H.MN_DATE LEFT OUTER JOIN
		                    (select * from TR_PIPES where PDMETER != '')  AS S ON D.MN_NO = S.MN_NO AND D.MN_DATE = S.MN_DATE AND D.PAGE_NO = S.PAGE_NO AND D.TANDB_TYPE = S.TANDB_TYPE
		               $WHERE123
		                GROUP BY
		                    H.CUST_CODE,
		                    H.SHIP_NO,
		                    D.PAGE_NO,
		                    D.TANDB_TYPE,
		                    D.PROC_TYPE,
		                    D.CS_QTY
		                ) AS DATA
		                GROUP BY
		                   CUST_CODE, SHIP_NO, PROC_TYPE, PDMETER
		            )AS M1
		                INNER  JOIN M_CUSTPCLS AS MS ON M1.CUST_CODE = MS.CUST_CODE AND M1.PROC_TYPE = MS.PROC_TYPE
		                INNER  JOIN (select * from M_CUSTPCLSNM where $PCLSNM_CODE1)   AS MM ON MS.CUST_CODE = MM.CUST_CODE AND MS.PCLSNM_CODE = MM.PCLSNM_CODE
		                LEFT JOIN M_CUST AS MT ON M1.CUST_CODE = MT.CUST_CODE
		                LEFT JOIN M_NAME MTTL ON MT.TTL_CODE =  MTTL.NAME_CODE AND MTTL.NAMECLS_CODE = 'TTL' AND MTTL.DSP_FLG ='0'
		) AS TBHK
		FULL JOIN
		(
		 SELECT
		        COALESCE(M1.CUST_CODE,'') AS CUST_CODE
		        ,COALESCE(MT.CUST1_NAME,'') AS CUST1_NAME
		        ,COALESCE(MTTL.NAME_NAME,'') AS TTL_NAME
		        ,COALESCE(M1.PDMETER,0) AS METER_NAME
		        ,COALESCE(M1.SHIP_NO,'') AS SHIP_NO
		        ,M1.CS_QTY AS CS_QTY
		        ,MM.PCLSNM_CODE AS PCLSNM_CODE
		        ,MT.TTL_CODE
		    FROM
		        (
		            SELECT
		                CUST_CODE,
		                SHIP_NO,
		                PROC_TYPE,
		                PDMETER,
		                SUM(CS_QTY) AS CS_QTY
		            FROM
		                (SELECT
		                    H.CUST_CODE,
		                    H.SHIP_NO,
		                    D.PAGE_NO,
		                    D.TANDB_TYPE,
		                    D.PROC_TYPE,
		                    D.CS_QTY,
		                    MAX(CAST(REPLACE(S.PDMETER, 'A', '') AS Numeric(4, 0))) AS PDMETER
		                FROM
		                    TR_PIPED AS D LEFT OUTER JOIN
		                    TR_PIPEH AS H ON D.MN_NO = H.MN_NO AND D.MN_DATE = H.MN_DATE LEFT OUTER JOIN
		                    (select * from TR_PIPES where PDMETER != '')  AS S ON D.MN_NO = S.MN_NO AND D.MN_DATE = S.MN_DATE AND D.PAGE_NO = S.PAGE_NO AND D.TANDB_TYPE = S.TANDB_TYPE
		                $WHERE123
		                GROUP BY
		                    H.CUST_CODE,
		                    H.SHIP_NO,
		                    D.PAGE_NO,
		                    D.TANDB_TYPE,
		                    D.PROC_TYPE,
		                    D.CS_QTY
		                ) AS DATA
		                GROUP BY
		                   CUST_CODE, SHIP_NO, PROC_TYPE, PDMETER
		            )AS M1
		                INNER  JOIN M_CUSTPCLS AS MS ON M1.CUST_CODE = MS.CUST_CODE AND M1.PROC_TYPE = MS.PROC_TYPE
		                INNER  JOIN (select * from M_CUSTPCLSNM where $PCLSNM_CODE2)   AS MM ON MS.CUST_CODE = MM.CUST_CODE AND MS.PCLSNM_CODE = MM.PCLSNM_CODE
		                LEFT JOIN M_CUST AS MT ON M1.CUST_CODE = MT.CUST_CODE
		                LEFT JOIN M_NAME MTTL ON MT.TTL_CODE =  MTTL.NAME_CODE AND MTTL.NAMECLS_CODE = 'TTL' AND MTTL.DSP_FLG ='0'
		) AS TBPL ON TBHK.CUST_CODE = TBPL.CUST_CODE and TBHK.TTL_CODE= TBPL.TTL_CODE and TBHK.SHIP_NO = TBPL.SHIP_NO and TBHK.METER_NAME = TBPL.METER_NAME
		FULL JOIN
		(
		 SELECT
		        COALESCE(M1.CUST_CODE,'') AS CUST_CODE
		        ,COALESCE(MT.CUST1_NAME,'') AS CUST1_NAME
		        ,COALESCE(MTTL.NAME_NAME,'') AS TTL_NAME
		        ,COALESCE(M1.PDMETER,0) AS METER_NAME
		        ,COALESCE(M1.SHIP_NO,'') AS SHIP_NO
		        ,M1.CS_QTY AS CS_QTY
		        ,MM.PCLSNM_CODE AS PCLSNM_CODE
		        ,MT.TTL_CODE
		    FROM
		        (
		            SELECT
		                CUST_CODE,
		                SHIP_NO,
		                PROC_TYPE,
		                PDMETER,
		                SUM(CS_QTY) AS CS_QTY
		            FROM
		                (SELECT
		                    H.CUST_CODE,
		                    H.SHIP_NO,
		                    D.PAGE_NO,
		                    D.TANDB_TYPE,
		                    D.PROC_TYPE,
		                    D.CS_QTY,
		                    MAX(CAST(REPLACE(S.PDMETER, 'A', '') AS Numeric(4, 0))) AS PDMETER
		                FROM
		                    TR_PIPED AS D LEFT OUTER JOIN
		                    TR_PIPEH AS H ON D.MN_NO = H.MN_NO AND D.MN_DATE = H.MN_DATE LEFT OUTER JOIN
		                    (select * from TR_PIPES where PDMETER != '') AS S ON D.MN_NO = S.MN_NO AND D.MN_DATE = S.MN_DATE AND D.PAGE_NO = S.PAGE_NO AND D.TANDB_TYPE = S.TANDB_TYPE
		                $WHERE123
		                GROUP BY
		                    H.CUST_CODE,
		                    H.SHIP_NO,
		                    D.PAGE_NO,
		                    D.TANDB_TYPE,
		                    D.PROC_TYPE,
		                    D.CS_QTY
		                ) AS DATA
		                GROUP BY
		                   CUST_CODE, SHIP_NO, PROC_TYPE, PDMETER
		            )AS M1
		                INNER  JOIN M_CUSTPCLS AS MS ON M1.CUST_CODE = MS.CUST_CODE AND M1.PROC_TYPE = MS.PROC_TYPE
		                INNER  JOIN (select * from M_CUSTPCLSNM where $PCLSNM_CODE3)   AS MM ON MS.CUST_CODE = MM.CUST_CODE AND MS.PCLSNM_CODE = MM.PCLSNM_CODE
		                LEFT JOIN M_CUST AS MT ON M1.CUST_CODE = MT.CUST_CODE
		                LEFT JOIN M_NAME MTTL ON MT.TTL_CODE =  MTTL.NAME_CODE AND MTTL.NAMECLS_CODE = 'TTL' AND MTTL.DSP_FLG ='0'
		) AS TBGN ON TBHK.CUST_CODE = TBGN.CUST_CODE and TBHK.TTL_CODE= TBGN.TTL_CODE and TBHK.SHIP_NO = TBGN.SHIP_NO and TBHK.METER_NAME = TBGN.METER_NAME

	GROUP BY
		COALESCE(TBHK.CUST_CODE,TBPL.CUST_CODE,TBGN.CUST_CODE)
	    ,COALESCE(TBHK.CUST1_NAME,TBPL.CUST1_NAME,TBGN.CUST1_NAME)
	    ,COALESCE(TBHK.TTL_NAME,TBPL.TTL_NAME,TBGN.TTL_NAME)
	    ,COALESCE(TBHK.METER_NAME,TBPL.METER_NAME,TBGN.METER_NAME)
	    ,COALESCE(TBHK.SHIP_NO,TBPL.SHIP_NO,TBGN.SHIP_NO)
	ORDER BY
	    COALESCE(TBHK.CUST_CODE,TBPL.CUST_CODE,TBGN.CUST_CODE)
	    ,COALESCE(TBHK.CUST1_NAME,TBPL.CUST1_NAME,TBGN.CUST1_NAME)
	    ,COALESCE(TBHK.TTL_NAME,TBPL.TTL_NAME,TBGN.TTL_NAME)
	    ,COALESCE(TBHK.SHIP_NO,TBPL.SHIP_NO,TBGN.SHIP_NO)
	    ,COALESCE(TBHK.METER_NAME,TBPL.METER_NAME,TBGN.METER_NAME)
	</M_REPORT017>

	<M_REPORT017_1>
			SELECT DISTINCT
		    COALESCE(TBHK.CUST_CODE, TBPL.CUST_CODE, TBGN.CUST_CODE) AS CUST_CODE
		    ,COALESCE(TBHK.CUST1_NAME, TBPL.CUST1_NAME, TBGN.CUST1_NAME) AS CUST1_NAME
		    ,COALESCE(TBHK.TTL_NAME, TBPL.TTL_NAME, TBGN.TTL_NAME) AS TTL_NAME
		    ,COALESCE(TBHK.METER_NAME, TBPL.METER_NAME, TBGN.METER_NAME) AS METER_NAME
		    ,COALESCE(TBHK.BLOCK_NAME, TBPL.BLOCK_NAME, TBGN.BLOCK_NAME) AS SHIP_BLOCK
		    ,SUM(TBHK.CS_QTY) AS $SUM1
		    ,SUM(TBPL.CS_QTY) AS $SUM2
		    ,SUM(TBGN.CS_QTY) AS $SUM3
		FROM
		(
		    SELECT
		        COALESCE(M1.CUST_CODE,'') AS CUST_CODE
		        ,COALESCE(MT.CUST1_NAME,'') AS CUST1_NAME
		        ,COALESCE(MTTL.NAME_NAME,'') AS TTL_NAME
		        ,COALESCE(M1.PDMETER,0) AS METER_NAME
		        ,COALESCE(M1.BLOCK_NAME,'') AS BLOCK_NAME
		        ,M1.CS_QTY AS CS_QTY
		        ,MM.PCLSNM_CODE AS PCLSNM_CODE
		        ,MT.TTL_CODE
		    FROM
		        (
		            SELECT
		                CUST_CODE,
		                BLOCK_NAME,
		                PROC_TYPE,
		                PDMETER,
		                SUM(CS_QTY) AS CS_QTY
		            FROM
		                (SELECT
		                    H.CUST_CODE,
		                    H.BLOCK_NAME,
		                    D.PAGE_NO,
		                    D.TANDB_TYPE,
		                    D.PROC_TYPE,
		                    D.CS_QTY,
		                    MAX(CAST(REPLACE(S.PDMETER, 'A', '') AS Numeric(4, 0))) AS PDMETER
		                FROM
		                    TR_PIPED AS D LEFT OUTER JOIN
		                    TR_PIPEH AS H ON D.MN_NO = H.MN_NO AND D.MN_DATE = H.MN_DATE LEFT OUTER JOIN
		                    (select * from TR_PIPES where PDMETER != '') AS S ON D.MN_NO = S.MN_NO AND D.MN_DATE = S.MN_DATE AND D.PAGE_NO = S.PAGE_NO AND D.TANDB_TYPE = S.TANDB_TYPE
		               $WHERE123
		                GROUP BY
		                    H.CUST_CODE,
		                    H.BLOCK_NAME,
		                    D.PAGE_NO,
		                    D.TANDB_TYPE,
		                    D.PROC_TYPE,
		                    D.CS_QTY
		                ) AS DATA
		                GROUP BY
		                   CUST_CODE, BLOCK_NAME, PROC_TYPE, PDMETER
		            )AS M1
		                INNER  JOIN M_CUSTPCLS AS MS ON M1.CUST_CODE = MS.CUST_CODE AND M1.PROC_TYPE = MS.PROC_TYPE
		                INNER  JOIN (select * from M_CUSTPCLSNM where $PCLSNM_CODE1)   AS MM ON MS.CUST_CODE = MM.CUST_CODE AND MS.PCLSNM_CODE = MM.PCLSNM_CODE
		                LEFT JOIN M_CUST AS MT ON M1.CUST_CODE = MT.CUST_CODE
		                LEFT JOIN M_NAME MTTL ON MT.TTL_CODE =  MTTL.NAME_CODE AND MTTL.NAMECLS_CODE = 'TTL' AND MTTL.DSP_FLG ='0'
		) AS TBHK
		FULL JOIN
		(
		 SELECT
		        COALESCE(M1.CUST_CODE,'') AS CUST_CODE
		        ,COALESCE(MT.CUST1_NAME,'') AS CUST1_NAME
		        ,COALESCE(MTTL.NAME_NAME,'') AS TTL_NAME
		        ,COALESCE(M1.PDMETER,0) AS METER_NAME
		        ,COALESCE(M1.BLOCK_NAME,'') AS BLOCK_NAME
		        ,M1.CS_QTY AS CS_QTY
		        ,MM.PCLSNM_CODE AS PCLSNM_CODE
		        ,MT.TTL_CODE
		    FROM
		        (
		            SELECT
		                CUST_CODE,
		                BLOCK_NAME,
		                PROC_TYPE,
		                PDMETER,
		                SUM(CS_QTY) AS CS_QTY
		            FROM
		                (SELECT
		                    H.CUST_CODE,
		                    H.BLOCK_NAME,
		                    D.PAGE_NO,
		                    D.TANDB_TYPE,
		                    D.PROC_TYPE,
		                    D.CS_QTY,
		                    MAX(CAST(REPLACE(S.PDMETER, 'A', '') AS Numeric(4, 0))) AS PDMETER
		                FROM
		                    TR_PIPED AS D LEFT OUTER JOIN
		                    TR_PIPEH AS H ON D.MN_NO = H.MN_NO AND D.MN_DATE = H.MN_DATE LEFT OUTER JOIN
		                    (select * from TR_PIPES where PDMETER != '') AS S ON D.MN_NO = S.MN_NO AND D.MN_DATE = S.MN_DATE AND D.PAGE_NO = S.PAGE_NO AND D.TANDB_TYPE = S.TANDB_TYPE
		                $WHERE123
		                GROUP BY
		                    H.CUST_CODE,
		                    H.BLOCK_NAME,
		                    D.PAGE_NO,
		                    D.TANDB_TYPE,
		                    D.PROC_TYPE,
		                    D.CS_QTY
		                ) AS DATA
		                GROUP BY
		                   CUST_CODE, BLOCK_NAME, PROC_TYPE, PDMETER
		            )AS M1
		                INNER  JOIN M_CUSTPCLS AS MS ON M1.CUST_CODE = MS.CUST_CODE AND M1.PROC_TYPE = MS.PROC_TYPE
		                INNER  JOIN (select * from M_CUSTPCLSNM where $PCLSNM_CODE2)   AS MM ON MS.CUST_CODE = MM.CUST_CODE AND MS.PCLSNM_CODE = MM.PCLSNM_CODE
		                LEFT JOIN M_CUST AS MT ON M1.CUST_CODE = MT.CUST_CODE
		                LEFT JOIN M_NAME MTTL ON MT.TTL_CODE =  MTTL.NAME_CODE AND MTTL.NAMECLS_CODE = 'TTL' AND MTTL.DSP_FLG ='0'
		) AS TBPL ON TBHK.CUST_CODE = TBPL.CUST_CODE and TBHK.TTL_CODE= TBPL.TTL_CODE and TBHK.BLOCK_NAME = TBPL.BLOCK_NAME and TBHK.METER_NAME = TBPL.METER_NAME
		FULL JOIN
		(
		 SELECT
		        COALESCE(M1.CUST_CODE,'') AS CUST_CODE
		        ,COALESCE(MT.CUST1_NAME,'') AS CUST1_NAME
		        ,COALESCE(MTTL.NAME_NAME,'') AS TTL_NAME
		        ,COALESCE(M1.PDMETER,0) AS METER_NAME
		        ,COALESCE(M1.BLOCK_NAME,'') AS BLOCK_NAME
		        ,M1.CS_QTY AS CS_QTY
		        ,MM.PCLSNM_CODE AS PCLSNM_CODE
		        ,MT.TTL_CODE
		    FROM
		        (
		            SELECT
		                CUST_CODE,
		                BLOCK_NAME,
		                PROC_TYPE,
		                PDMETER,
		                SUM(CS_QTY) AS CS_QTY
		            FROM
		                (SELECT
		                    H.CUST_CODE,
		                    H.BLOCK_NAME,
		                    D.PAGE_NO,
		                    D.TANDB_TYPE,
		                    D.PROC_TYPE,
		                    D.CS_QTY,
		                    MAX(CAST(REPLACE(S.PDMETER, 'A', '') AS Numeric(4, 0))) AS PDMETER
		                FROM
		                    TR_PIPED AS D LEFT OUTER JOIN
		                    TR_PIPEH AS H ON D.MN_NO = H.MN_NO AND D.MN_DATE = H.MN_DATE LEFT OUTER JOIN
		                    (select * from TR_PIPES where PDMETER != '') AS S ON D.MN_NO = S.MN_NO AND D.MN_DATE = S.MN_DATE AND D.PAGE_NO = S.PAGE_NO AND D.TANDB_TYPE = S.TANDB_TYPE
		                $WHERE123
		                GROUP BY
		                    H.CUST_CODE,
		                    H.BLOCK_NAME,
		                    D.PAGE_NO,
		                    D.TANDB_TYPE,
		                    D.PROC_TYPE,
		                    D.CS_QTY
		                ) AS DATA
		                GROUP BY
		                   CUST_CODE, BLOCK_NAME, PROC_TYPE, PDMETER
		            )AS M1
		                INNER  JOIN M_CUSTPCLS AS MS ON M1.CUST_CODE = MS.CUST_CODE AND M1.PROC_TYPE = MS.PROC_TYPE
		                INNER  JOIN (select * from M_CUSTPCLSNM where $PCLSNM_CODE3)   AS MM ON MS.CUST_CODE = MM.CUST_CODE AND MS.PCLSNM_CODE = MM.PCLSNM_CODE
		                LEFT JOIN M_CUST AS MT ON M1.CUST_CODE = MT.CUST_CODE
		                LEFT JOIN M_NAME MTTL ON MT.TTL_CODE =  MTTL.NAME_CODE AND MTTL.NAMECLS_CODE = 'TTL' AND MTTL.DSP_FLG ='0'
		) AS TBGN ON TBHK.CUST_CODE = TBGN.CUST_CODE and TBHK.TTL_CODE= TBGN.TTL_CODE and TBHK.BLOCK_NAME = TBGN.BLOCK_NAME and TBHK.METER_NAME = TBGN.METER_NAME
	GROUP BY
		COALESCE(TBHK.CUST_CODE,TBPL.CUST_CODE,TBGN.CUST_CODE)
	    ,COALESCE(TBHK.CUST1_NAME,TBPL.CUST1_NAME,TBGN.CUST1_NAME)
	    ,COALESCE(TBHK.TTL_NAME,TBPL.TTL_NAME,TBGN.TTL_NAME)
	    ,COALESCE(TBHK.METER_NAME,TBPL.METER_NAME,TBGN.METER_NAME)
	    ,COALESCE(TBHK.BLOCK_NAME,TBPL.BLOCK_NAME,TBGN.BLOCK_NAME)
	ORDER BY
	    COALESCE(TBHK.CUST_CODE,TBPL.CUST_CODE,TBGN.CUST_CODE)
	    ,COALESCE(TBHK.CUST1_NAME,TBPL.CUST1_NAME,TBGN.CUST1_NAME)
	    ,COALESCE(TBHK.TTL_NAME,TBPL.TTL_NAME,TBGN.TTL_NAME)
	    ,COALESCE(TBHK.BLOCK_NAME,TBPL.BLOCK_NAME,TBGN.BLOCK_NAME)
	    ,COALESCE(TBHK.METER_NAME,TBPL.METER_NAME,TBGN.METER_NAME)
	</M_REPORT017_1>
	<M_REPORT017_2>
	SELECT
        COALESCE(M1.CUST_CODE,'') AS CUST_CODE
        ,COALESCE(MT.CUST1_NAME,'') AS CUST1_NAME
        ,COALESCE(MTTL.NAME_NAME,'') AS TTL_NAME
        ,COALESCE(M1.PDMETER,0) AS METER_NAME
        ,COALESCE(M1.SHIP_NO,'') AS SHIP_BLOCK
        ,M1.CS_QTY AS CS_QTY
        ,MM.PCLSNM_CODE AS PCLSNM_CODE
        ,MT.TTL_CODE
    FROM
        (
            SELECT
                CUST_CODE,
                SHIP_NO,
                PROC_TYPE,
                PDMETER,
                SUM(CS_QTY) AS CS_QTY
            FROM
                (SELECT
                    H.CUST_CODE,
                    H.SHIP_NO,
                    D.PAGE_NO,
                    D.TANDB_TYPE,
                    D.PROC_TYPE,
                    D.CS_QTY,
                    MAX(CAST(REPLACE(S.PDMETER, 'A', '') AS Numeric(4, 0))) AS PDMETER
                FROM
                    TR_PIPED AS D LEFT OUTER JOIN
                    TR_PIPEH AS H ON D.MN_NO = H.MN_NO AND D.MN_DATE = H.MN_DATE LEFT OUTER JOIN
                    (select * from TR_PIPES where PDMETER != '') AS S ON D.MN_NO = S.MN_NO AND D.MN_DATE = S.MN_DATE AND D.PAGE_NO = S.PAGE_NO AND D.TANDB_TYPE = S.TANDB_TYPE
                $WHERE123
                GROUP BY
                    H.CUST_CODE,
                    H.SHIP_NO,
                    D.PAGE_NO,
                    D.TANDB_TYPE,
                    D.PROC_TYPE,
                    D.CS_QTY
                ) AS DATA
                GROUP BY
                   CUST_CODE, SHIP_NO, PROC_TYPE, PDMETER
            )AS M1
                INNER  JOIN M_CUSTPCLS AS MS ON M1.CUST_CODE = MS.CUST_CODE AND M1.PROC_TYPE = MS.PROC_TYPE
                INNER  JOIN (select * from M_CUSTPCLSNM where $PCLSNM_CODE)   AS MM ON MS.CUST_CODE = MM.CUST_CODE AND MS.PCLSNM_CODE = MM.PCLSNM_CODE
                LEFT JOIN M_CUST AS MT ON M1.CUST_CODE = MT.CUST_CODE
                LEFT JOIN M_NAME MTTL ON MT.TTL_CODE =  MTTL.NAME_CODE AND MTTL.NAMECLS_CODE = 'TTL' AND MTTL.DSP_FLG ='0'
	</M_REPORT017_2>
	<M_REPORT017_3>
	SELECT
        COALESCE(M1.CUST_CODE,'') AS CUST_CODE
        ,COALESCE(MT.CUST1_NAME,'') AS CUST1_NAME
        ,COALESCE(MTTL.NAME_NAME,'') AS TTL_NAME
        ,COALESCE(M1.PDMETER,0) AS METER_NAME
        ,COALESCE(M1.BLOCK_NAME,'') AS SHIP_BLOCK
        ,M1.CS_QTY AS CS_QTY
        ,MM.PCLSNM_CODE AS PCLSNM_CODE
        ,MT.TTL_CODE
    FROM
        (
            SELECT
                CUST_CODE,
                BLOCK_NAME,
                PROC_TYPE,
                PDMETER,
                SUM(CS_QTY) AS CS_QTY
            FROM
                (SELECT
                    H.CUST_CODE,
                    H.BLOCK_NAME,
                    D.PAGE_NO,
                    D.TANDB_TYPE,
                    D.PROC_TYPE,
                    D.CS_QTY,
                    MAX(CAST(REPLACE(S.PDMETER, 'A', '') AS Numeric(4, 0))) AS PDMETER
                FROM
                    TR_PIPED AS D LEFT OUTER JOIN
                    TR_PIPEH AS H ON D.MN_NO = H.MN_NO AND D.MN_DATE = H.MN_DATE LEFT OUTER JOIN
                    (select * from TR_PIPES where PDMETER != '') AS S ON D.MN_NO = S.MN_NO AND D.MN_DATE = S.MN_DATE AND D.PAGE_NO = S.PAGE_NO AND D.TANDB_TYPE = S.TANDB_TYPE
                $WHERE123
                GROUP BY
                    H.CUST_CODE,
                    H.BLOCK_NAME,
                    D.PAGE_NO,
                    D.TANDB_TYPE,
                    D.PROC_TYPE,
                    D.CS_QTY
                ) AS DATA
                GROUP BY
                   CUST_CODE, BLOCK_NAME, PROC_TYPE, PDMETER
            )AS M1
                INNER  JOIN M_CUSTPCLS AS MS ON M1.CUST_CODE = MS.CUST_CODE AND M1.PROC_TYPE = MS.PROC_TYPE
                INNER  JOIN (select * from M_CUSTPCLSNM where $PCLSNM_CODE)   AS MM ON MS.CUST_CODE = MM.CUST_CODE AND MS.PCLSNM_CODE = MM.PCLSNM_CODE
                LEFT JOIN M_CUST AS MT ON M1.CUST_CODE = MT.CUST_CODE
                LEFT JOIN M_NAME MTTL ON MT.TTL_CODE =  MTTL.NAME_CODE AND MTTL.NAMECLS_CODE = 'TTL' AND MTTL.DSP_FLG ='0'
	</M_REPORT017_3>
	
	<M_REPORT009>
		SELECT
			B.CUST_CODE,
			B.CUST1_NAME,
			B.SHIP_NO,
			B.DRAW_TYPE,
			B.SIGN_NO,

			B.BLOCK_NAME,
			B.DRAW_NO,
			B.LCLS_CODE,
			B.PROC_TYPE,
			B.PROC_NAME,

			B.DSPORDER_NO ,
			SUM(B.TLEN_QTY) AS TLEN_QTY,
			MAX(B.TCS_QTY) AS TCS_QTY ,
			MAX(B.WT_QTY) AS WT_QTY
		FROM (
				SELECT
					M.CUST_CODE,
					CUST.CUST1_NAME,
					M.SHIP_NO,
					M.DRAW_TYPE,
					M.SIGN_NO,

					M.BLOCK_NAME,
					M.DRAW_NO,
					M.LCLS_CODE,
					M.PROC_TYPE,
					NAME_PROC.NAME_RNAME AS PROC_NAME,

					NAME_PROC.DSPORDER_NO,
					TLEN_QTY = CASE
							WHEN (M.LCLS_CODE = '0' AND M.KIND_CODE = '') THEN SUM(M.TLEN_QTY / (COALESCE(convert(int, MCTL.C_DATA), 5510) ) * M.WT_QTY)
							WHEN (M.LCLS_CODE = '0' AND M.KIND_CODE = '1') THEN SUM(M.TLEN_QTY / (COALESCE(convert(int, MKIND1.LENTO_QRY ), 4005) ) * M.WT_QTY)
							WHEN (M.LCLS_CODE = '0' AND M.KIND_CODE = '2') THEN SUM(M.TLEN_QTY / (COALESCE(convert(int, MKIND2.LENTO_QRY ), 6006) ) * M.WT_QTY)
							WHEN (M.LCLS_CODE = '1' AND M.MCLS_CODE = '14') THEN SUM(M.TLEN_QTY / (COALESCE(convert(int, MCTL.C_DATA), 5510) ) * M.WT_QTY)
							WHEN (M.LCLS_CODE = '1' AND M.MCLS_CODE = '15') THEN SUM(M.TLEN_QTY / (COALESCE(convert(int, MCTL.C_DATA), 5510) ) * M.WT_QTY)
							WHEN (M.LCLS_CODE = '1' AND M.MCLS_CODE = '18') THEN SUM(M.TLEN_QTY / (COALESCE(convert(int, MCTL.C_DATA), 5510) ) * M.WT_QTY)
							ELSE SUM(M.TCS_QTY * M.WT_QTY)
						END,
					MAX(H.WT_QTY) AS TCS_QTY,
					MAX(M.WT_QTY) AS WT_QTY
				FROM
					F_PIPESUM M
					LEFT JOIN M_NAME NAME_PROC ON M.PROC_TYPE = NAME_PROC.NAME_CODE AND NAME_PROC.NAMECLS_CODE = 'PROC'
					LEFT JOIN M_CUST CUST ON M.CUST_CODE = CUST.CUST_CODE
					LEFT JOIN M_CTL MCTL ON (MCTL.C_KEY = 'PIPE_LEN' AND MCTL.USERID = 'SYSTEM')
					LEFT JOIN M_KIND MKIND1 ON (MKIND1.KIND_CODE = '1')
					LEFT JOIN M_KIND MKIND2 ON (MKIND2.KIND_CODE = '2')
					LEFT JOIN TR_PIPEH H ON H.CUST_CODE = M.CUST_CODE AND H.SHIP_NO = M.SHIP_NO AND H.DRAW_TYPE = M.DRAW_TYPE AND H.SIGN_NO = M.SIGN_NO AND H.BLOCK_NAME = M.BLOCK_NAME
				strCondition
				GROUP BY
					M.CUST_CODE,
					CUST.CUST1_NAME,
					M.SHIP_NO,
					M.DRAW_TYPE,
					M.SIGN_NO,
					M.BLOCK_NAME,
					M.DRAW_NO,
					M.LCLS_CODE,
					M.MCLS_CODE,
					M.PROC_TYPE,
					NAME_PROC.NAME_RNAME,
					NAME_PROC.DSPORDER_NO,
					M.KIND_CODE
		) AS B
		GROUP BY
			B.CUST_CODE,
			B.CUST1_NAME,
			B.SHIP_NO,
			B.DRAW_TYPE,
			B.SIGN_NO,
			B.BLOCK_NAME,
			B.DRAW_NO,
			B.LCLS_CODE,
			B.PROC_TYPE,
			B.PROC_NAME,
			B.DSPORDER_NO
		ORDER BY
			B.CUST_CODE,
			B.SHIP_NO,
			B.DRAW_TYPE,
			B.SIGN_NO,
			B.BLOCK_NAME,
			B.DRAW_NO,
			B.LCLS_CODE,
			B.DSPORDER_NO
	</M_REPORT009>

	<M_REPORT015>
		  SELECT
	        	    MC.CUST_CODE AS CUST_CODE,
	        	    MC.CUST1_NAME AS CUST_NAME,
	        	    H.SHIP_NO AS SHIP_NO,
	                H.DRAW_TYPE AS DRAW_TYPE,
                    H.MN_DATE AS MN_DATE,
	        	    MNA.NAME_NAME AS DRAW_NAME,
	        	    MCLS.MCLS_TNAME AS MCLS_NAME,
	        	    TP.TYPE_NAME AS TYPE_NAME,
	        	    MA.MATER_TNAME AS MATER_NAME,
	        	    S.PDMETER AS PDMETER,
	        	    COALESCE(STD.STD_NAME,'')+ ' '+ COALESCE(MK.KIND_NAME,'') AS STD_NAME,
	        	    S.SIZE_NAME AS SIZE_NAME,
	        	    SUM(S.ORDR_QTY) AS SUM_ORDRQTY
	       FROM
	                TR_ORDRH H JOIN TR_ORDRD AS S ON S.ORDR_NO = H.ORDR_NO AND S.MN_DATE = H.MN_DATE AND H.CUST_CODE = S.CUST_CODE AND H.DRAW_TYPE= S.DRAW_TYPE
	        	    LEFT JOIN M_CUST AS MC ON H.CUST_CODE = MC.CUST_CODE
	        	    LEFT JOIN M_MCLS MCLS ON S.LCLS_CODE = MCLS.LCLS_CODE AND S.MCLS_CODE = MCLS.MCLS_CODE
	        	    LEFT JOIN M_TYPE TP ON S.TYPE_CODE = TP.TYPE_CODE
	        	    LEFT JOIN M_MATER MA ON S.MATER_CODE = MA.MATER_CODE
	        	    LEFT JOIN M_STD STD ON S.STD_CODE = STD.STD_CODE
	        	    LEFT JOIN M_NAME MNA ON NAMECLS_CODE = 'DRAW' AND MNA.NAME_CODE = H.DRAW_TYPE
	        	    LEFT JOIN  M_NAME PD ON (PD.NAMECLS_CODE = 'PDMETER' AND PD.DSP_FLG ='0' AND S.PDMETER =  PD.NAME_CODE)
	    			LEFT JOIN M_KIND AS MK ON MK.KIND_CODE =  S.KIND_CODE
	    GROUP BY
                MC.CUST_CODE,
                MC.CUST1_NAME,
                H.SHIP_NO,
                H.DRAW_TYPE,
                MNA.NAME_NAME,
            	MCLS.LCLS_CODE,
                MCLS.MCLS_TNAME,
             	MCLS.MCLS_CODE,
                MA.MATER_TNAME,
                MA.DSPORDER_NO,
                S.PDMETER,
                PD.DSPORDER_NO,
                TP.TYPE_NAME,
                TP.DSPORDER_NO,
                STD.STD_NAME,
                MK.KIND_NAME,
                STD.DSPORDER_NO,
                S.SIZE_NAME,
                H.MN_DATE
         $HAVING
	</M_REPORT015>
</System>
