<?xml version="1.0" encoding="utf-8" ?>
<System>
  <F_LOG001>
            INSERT INTO F_LOG(
      USER_USER,
            ACT_DATE,
            ACT_TIME,
            MENUGRP_CODE,
            MENUEXE_CODE,
            ACTION_TYPE,
            TEXT,
      PCID
             )VALUES
    (?,?,?,?,?,?,?,?)
  </F_LOG001>
  <!-- START P_Menu[メニュー] -->
  <!-- ユーザーのログを取るために -->
  <F_LOG002>
    SELECT
      F.ACT_TIME,
      RTRIM(COALESCE(TBL.EMP_TNAME,'')) AS EMP_NAME,
      RTRIM(COALESCE(M.MENUEXE_NAME,'')) AS MENUEXE_NAME,
      --RTRIM(F.ACTION_TYPE) AS ACTION_TYPE,
      RTRIM(NM.NAME_RNAME) AS ACTION_NAME,
      RTRIM(F.TEXT) AS TEXT,
      TBL.EMP_CODE,
      '1' AS USERTYPE
    FROM
      F_LOG AS F
    LEFT JOIN
      M_MENUEXE AS M
    ON
      F.MENUGRP_CODE = M.MENUGRP_CODE
    AND
      F.MENUEXE_CODE = M.MENUEXE_CODE
    LEFT JOIN
      (SELECT
        ME.EMP_TNAME,
        ME.EMP_USER,
        MU.USERGID,
        ME.EMP_CODE
      FROM
        M_EMP AS ME
      LEFT JOIN
        M_USERGRP AS MU
      ON
        ME.USER_USER = MU.USERGID
      ) AS TBL
    ON
      F.USER_USER = TBL.EMP_USER
	LEFT JOIN M_NAME AS NM
	ON
	 NM.NAMECLS_CODE = 'LOGACT'
	AND
	 NM.NAME_CODE = F.ACTION_TYPE

    $WHERE
  </F_LOG002>
  <!-- グループのログを取るために -->
  <F_LOG003>
		        SELECT
			     RTRIM(RIGHT('00' + CAST(F.ACT_TIME AS VARCHAR),6)) AS ACT_TIME
			    ,RTRIM(U.USERTXT) AS EMP_NAME
			    ,RTRIM(E.MENUEXE_NAME) AS MENUEXE_NAME
			    --,RTRIM(F.ACTION_TYPE) AS ACTION_TYPE
			    ,RTRIM(NM.NAME_RNAME) AS ACTION_NAME
			    ,RTRIM(F.TEXT) AS TEXT
			    ,RTRIM(U.USERGID) AS EMP_CODE
			    ,'0' AS USERTYPE
			FROM
			    F_LOG F
			LEFT JOIN M_NAME A
			    ON A.NAMECLS_CODE = 'LOGACT'
			   AND A.NAME_CODE = F.ACTION_TYPE

			LEFT JOIN M_MENUEXE E
			ON E.MENUGRP_CODE = F.MENUGRP_CODE
			AND E.MENUEXE_CODE = F.MENUEXE_CODE

			LEFT JOIN M_USERGRP U
			ON U.USERGID = F.USER_USER
			LEFT JOIN M_NAME AS NM
			ON NM.NAMECLS_CODE = 'LOGACT'
			AND NM.NAME_CODE = F.ACTION_TYPE

      $WHERE
    </F_LOG003>

    <F_LOG004>
		SELECT
		     L.ACT_DATE AS ACT_DATE
		    ,L.ACT_TIME AS ACT_TIME
		    ,RTRIM(U.EMP_TNAME) AS EMP_USER
		    ,RTRIM(L.USER_USER) AS USER_USER
		    ,RTRIM(E.MENUEXE_NAME) AS MENUEXE_NAME
		    ,RTRIM(A.NAME_NAME) AS ACTION_TYPE
		    ,RTRIM(L.TEXT) AS MEMO
		    ,RTRIM(L.PCID) AS PCNAME
		FROM
		    F_LOG L
		LEFT JOIN M_NAME A
		    ON A.NAMECLS_CODE = 'LOGACT'
		   AND A.NAME_CODE = L.ACTION_TYPE

		LEFT JOIN M_MENUEXE E
		    ON E.MENUGRP_CODE = L.MENUGRP_CODE
		   AND E.MENUEXE_CODE = L.MENUEXE_CODE

		LEFT JOIN M_EMP U
		   ON U.EMP_USER = L.USER_USER
   </F_LOG004>
		
	<F_LOG500>
            INSERT INTO F_LOG(
				USER_USER,
				ACT_DATE,
				ACT_TIME,
				MENUGRP_CODE,
				MENUEXE_CODE,
				ACTION_TYPE,
				TEXT,
				PCID)
			VALUES(?,?,?,?,?,?,?,?)
	</F_LOG500>
	
	<F_LOG510>
	SELECT F.ACT_DATE,
	       F.ACT_TIME,
	       RTRIM(COALESCE(TBL.EMP_TNAME, '')) AS EMP_NAME,
	       RTRIM(COALESCE(M.MENUEXE_NAME, '')) AS MENUEXE_NAME,
	       --RTRIM(F.ACTION_TYPE) AS ACTION_TYPE,
	       RTRIM(NM.NAME_RNAME) AS ACTION_NAME,
	       RTRIM(F.TEXT) AS TEXT,
	       TBL.EMP_CODE,
	       F.PCID,
	       '1' AS USERTYPE
	FROM   F_LOG AS F
	       LEFT JOIN M_MENUEXE AS M
	            ON  F.MENUGRP_CODE = M.MENUGRP_CODE
	            AND F.MENUEXE_CODE = M.MENUEXE_CODE
	       LEFT JOIN (
	                SELECT ME.EMP_TNAME,
	                       ME.EMP_USER,
	                       MU.USERGID,
	                       ME.EMP_CODE
	                FROM   M_EMP AS ME
	                       LEFT JOIN M_USERGRP AS MU
	                            ON  ME.USER_USER = MU.USERGID
	            ) AS TBL
	            ON  F.USER_USER = TBL.EMP_USER
	       LEFT JOIN M_NAME AS NM
	            ON  NM.NAMECLS_CODE = 'LOGACT'
	            AND NM.NAME_CODE = F.ACTION_TYPE
	
	</F_LOG510>
	<F_LOG511>
	   SELECT
	   F.ACT_DATE,
	       F.ACT_TIME,
	      RTRIM(U.USERTXT) AS EMP_NAME,
	      RTRIM(M.MENUEXE_NAME) AS MENUEXE_NAME,
				    RTRIM(NM.NAME_RNAME) AS ACTION_NAME
				    ,RTRIM(F.TEXT) AS TEXT
				    ,RTRIM(U.USERGID) AS EMP_CODE,
				    F.PCID
				    ,'0' AS USERTYPE
				FROM
				    F_LOG F
				LEFT JOIN M_MENUEXE M
				ON M.MENUGRP_CODE = F.MENUGRP_CODE
				AND M.MENUEXE_CODE = F.MENUEXE_CODE
	
				LEFT JOIN M_USERGRP U
				ON U.USERGID = F.USER_USER
				LEFT JOIN M_NAME AS NM
				ON NM.NAMECLS_CODE = 'LOGACT'
				AND NM.NAME_CODE = F.ACTION_TYPE
	</F_LOG511>
	
	
	<F_LOG514>
	SELECT COUNT(F.ACT_DATE) AS COUNT
	FROM   F_LOG AS F
	       LEFT JOIN M_MENUEXE AS M
	            ON  F.MENUGRP_CODE = M.MENUGRP_CODE
	            AND F.MENUEXE_CODE = M.MENUEXE_CODE
	       LEFT JOIN (
	                SELECT ME.EMP_TNAME,
	                       ME.EMP_USER,
	                       MU.USERGID,
	                       ME.EMP_CODE
	                FROM   M_EMP AS ME
	                       LEFT JOIN M_USERGRP AS MU
	                            ON  ME.USER_USER = MU.USERGID
	            ) AS TBL
	            ON  F.USER_USER = TBL.EMP_USER
	       LEFT JOIN M_NAME AS NM
	            ON  NM.NAMECLS_CODE = 'LOGACT'
	            AND NM.NAME_CODE = F.ACTION_TYPE
	
	</F_LOG514>
	<F_LOG515>
	   SELECT
	  COUNT( F.ACT_DATE) AS COUNT
				FROM
				    F_LOG F
				LEFT JOIN M_MENUEXE M
				ON M.MENUGRP_CODE = F.MENUGRP_CODE
				AND M.MENUEXE_CODE = F.MENUEXE_CODE
	
				LEFT JOIN M_USERGRP U
				ON U.USERGID = F.USER_USER
				LEFT JOIN M_NAME AS NM
				ON NM.NAMECLS_CODE = 'LOGACT'
				AND NM.NAME_CODE = F.ACTION_TYPE
	</F_LOG515>
	
	<!--Add by HUNG NV 2010.04.28-->
	<F_LOG516>
		SELECT COUNT (*)
		  FROM F_LOG
	</F_LOG516>
	
	<!-- begin: exportExcel -->
	<F_LOG009>	  
	  SELECT COALESCE(F.ACT_DATE, '') AS ACT_DATE
		   , COALESCE(F.ACT_TIME, '') AS ACT_TIME
		   , RTRIM(COALESCE(E.EMP_TNAME, '')) AS USER_USER
		   , RTRIM(COALESCE(M.MENUEXE_NAME, '')) AS MENUEXE_CODE
		   , RTRIM(COALESCE(NM.NAME_RNAME, '')) AS ACTION_TYPE
		   , RTRIM(COALESCE(F.TEXT, '')) AS TEXT
		   , COALESCE(E.EMP_CODE, '') AS EMP_CODE
		   , COALESCE(F.PCID, '') AS PCID
		   , '1' AS USER_TYPE
		FROM F_LOG AS F LEFT JOIN M_MENUEXE AS M ON F.MENUGRP_CODE = M.MENUGRP_CODE
												AND F.MENUEXE_CODE = M.MENUEXE_CODE
						LEFT JOIN (SELECT ME.EMP_TNAME
										, ME.EMP_USER
										, MU.USERGID
										, ME.EMP_CODE
									 FROM M_EMP AS ME LEFT JOIN M_USERGRP AS MU ON ME.USER_USER = MU.USERGID
	            					)AS E
							   ON F.USER_USER = E.EMP_USER
						LEFT JOIN M_NAME AS NM ON NM.NAMECLS_CODE = 'LOGACT'
											  AND NM.NAME_CODE = F.ACTION_TYPE
	</F_LOG009>
	<!-- end: exportExcel -->
	
	<!-- begin: exportExcel -->
	<F_LOG010>	  
	  SELECT COALESCE(F.ACT_DATE, '') AS ACT_DATE
		   , COALESCE(F.ACT_TIME, '') AS ACT_TIME
		   , RTRIM(COALESCE(E.EMP_TNAME, '')) AS USER_USER
		   , RTRIM(COALESCE(M.MENUEXE_NAME, '')) AS MENUEXE_CODE
		   , RTRIM(COALESCE(NM.NAME_RNAME, '')) AS ACTION_TYPE
		   , RTRIM(COALESCE(F.TEXT, '')) AS TEXT
		   , COALESCE(E.EMP_CODE, '') AS EMP_CODE
		   , COALESCE(F.PCID, '') AS PCID
		   , '0' AS USER_TYPE
		FROM F_LOG AS F LEFT JOIN M_MENUEXE AS M ON F.MENUGRP_CODE = M.MENUGRP_CODE
												AND F.MENUEXE_CODE = M.MENUEXE_CODE
						LEFT JOIN (SELECT ME.EMP_TNAME
										, ME.EMP_USER
										, MU.USERGID
										, ME.EMP_CODE
									 FROM M_EMP AS ME LEFT JOIN M_USERGRP AS MU ON ME.USER_USER = MU.USERGID
	            					)AS E
							   ON F.USER_USER = E.EMP_USER
						LEFT JOIN M_NAME AS NM ON NM.NAMECLS_CODE = 'LOGACT'
											  AND NM.NAME_CODE = F.ACTION_TYPE
	</F_LOG010>
	<!-- end: exportExcel -->
</System>
